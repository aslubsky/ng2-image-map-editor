{"version":3,"sources":["../../src/utils.class.ts","../../src/help.class.ts","../../node_modules/tslib/tslib.es6.js","../../src/area.class.ts","../../src/helper.class.ts","../../src/rectangle.class.ts","../../src/circle.class.ts","../../src/polygon.class.ts","../../src/area-factory.class.ts","../../src/app-event.class.ts","../../src/buttons.class.ts","../../src/editor-app.class.ts","../../src/ng2-image-map-editor.directive.ts","../../src/ng2-image-map-editor.module.ts"],"names":["Utils","getOffset","node","boxCoords","getBoundingClientRect","x","Math","round","left","window","pageXOffset","y","top","pageYOffset","getRightCoords","app","id","str","document","getElementById","hide","style","display","this","show","encode","replace","foreach","arr","func","i","count","length","foreachReverse","stopEvent","e","stopPropagation","preventDefault","Help","block","overlay","close_button","querySelector","addEventListener","bind","prototype","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__extends","__","constructor","create","Area","coords","type","attributes","href","alt","title","_params","_groupEl","createElementNS","SVG_NS","addNodeToSvg","obj","_el","_helpers","testCoords","Error","setCoords","params","redraw","remove","removeNodeFromSvg","select","classList","add","CLASS_NAMES","SELECTED","deselect","with_href","WITH_HREF","without_href","setInfoAttributes","toJSON","HTML","Helper","action","CLASS_NAME","setAttribute","SIZENum","OFFSET","SIZE","appendChild","ACTIONS_TO_CURSORS","setNumber","textContent","setId","n","ceil","move","editLeft","editRight","editTop","editBottom","editTopLeft","editTopRight","editBottomLeft","editBottomRight","pointMove","number","Rectangle","_super","_this","call","width","height","center","bottom","right","topLeft","topRight","bottomLeft","bottomRight","addObject","setSVGAttributes","center_y","center_x","setParams","getNormalizedCoords","dynamicDraw","x1","y1","isSquare","new_x","new_y","new_width","new_height","delta","temp_params","x0","y0","abs","onProcessDrawing","pageX","pageY","shiftKey","onStopDrawing","removeAllEvents","setIsDraw","resetNewArea","dx","dy","edit","editingType","tempParams","assign","dynamicEdit","saveProportions","proportions","onProcessEditing","getEditType","onStopEditing","toString","x2","y2","createFromSaved","area","createAndStartDrawing","getAreas","newArea","addEvent","domElements","container","Circle","cx","cy","radius","sqrt","editType","Polygon","points","selected_point","coords_values","join","helper","isArray","slice","addPoint","push","right_angle","old_x","old_y","tan","concat","right_coords","onAddPointDrawing","keyCode","_polyline","replaceChild","c","AreaFactory","CONSTRUCTORS","rectangle","circle","polygon","AppEvent","target","eventType","removeEventListener","Buttons","all","getElementsByTagName","clear","to_html","show_help","onShapeButtonClick","onClearButtonClick","onToHtmlButtonClick","onEditButtonClick","onShowHelpButtonClick","deselectAll","selectOne","button","parentNode","onSetInvalid","setMode","setDrawClass","setShape","hidePreview","confirm","setDefaultClass","answers","scale","state","image","img","clientWidth","Number","toFixed","resultsAnswers","forEach","item","imgMapData","body","is_right","img_map","JSON","stringify","onData","getAreasJSON","getMode","svg","setEditClass","areas","help","CursorPositionInfo","_coords_info","set","innerHTML","empty","EditorApp","wrapper","map","editor","offset","appMode","currentType","selectedArea","events","isDraw","src","filename","recalcOffsetValues","cursor_position_info","onSvgMousedown","onSvgClick","onAreaDblClick","onDocumentKeyDown","buttons","tagName","contains","ctrlDown","ctrlKey","metaKey","KEYS","F1","ESC","pop","TOP","BOTTOM","LEFT","RIGHT","DELETE","removeObject","I","C","Constructor","area_params","setDimensions","onImageLoaded","loadImage","url","tmp_arr","split","onload","setFilename","preview","createElement","removeChild","arg","childNodes","splice","getIsDraw","onSetMode","mode","onCurrentType","getShape","object","getNewArea","getSelectedArea","setSelectedArea","undefined","data","getHTMLCode","html_code","S","Ng2ImageMapEditorDirective","valid","isEditMode","icons","labels","_loadedImage","onAnswersUpdated","EventEmitter","propagateChange","_","validate","required","registerOnChange","fn","registerOnTouched","writeValue","value","_value","_parsedValue","parse","mainImageWidth","ngOnInit","globalLabels","emit","mainImageSrc","ngOnChanges","changes","save_answers","drawing_mode","drawing_mode_enter","drawing_mode_esc","drawing_mode_shift","editing_mode","editing_mode_delete","editing_mode_esc","editing_mode_shift","editing_mode_up","editing_mode_down","editing_mode_left","editing_mode_right","selectors","inputs","outputs","features","i0","ɵɵProvidersFeature","provide","NG_VALUE_ACCESSOR","useExisting","forwardRef","multi","NG_VALIDATORS","ɵɵNgOnChangesFeature","attrs","decls","vars","consts","template","rf","ctx","i0.ɵɵelementStart","i0.ɵɵnamespaceSVG","i0.ɵɵelement","i0.ɵɵelementEnd","i0.ɵɵnamespaceHTML","i0.ɵɵtext","i0.ɵɵadvance","i0.ɵɵclassProp","i0.ɵɵpropertyInterpolate","i0.ɵɵproperty","i0.ɵɵtextInterpolate","i0.ɵɵtextInterpolate1","Ng2ImageMapEditorModule","imports","declarations","exports"],"mappings":"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","sourcesContent":["export class Utils {\n    public static app: any;\n\n    /**\n     * Returns offset from html page top-left corner for some element\n     *\n     * @param node {HTMLElement} - html element\n     * @returns {Object} - object with offsets, e.g. {x: 100, y: 200}\n     */\n    public static getOffset(node) {\n        var boxCoords = node.getBoundingClientRect();\n        return {\n            x: Math.round(boxCoords.left + window.pageXOffset),\n            y: Math.round(boxCoords.top + window.pageYOffset)\n        };\n    }\n\n    /**\n     * Returns correct coordinates (incl. offsets)\n     *\n     * @param x {number} - x-coordinate\n     * @param y {number} - y-coordinate\n     * @returns {Object} - object with recalculated coordinates, e.g. {x: 100, y: 200}\n     */\n    public static getRightCoords(x, y) {\n        return {\n            x: x - Utils.app.getOffset('x'),\n            y: y - Utils.app.getOffset('y')\n        };\n    }\n\n    /**\n     * TODO: will use same method of app.js\n     * @deprecated\n     */\n    public static id(str) {\n        return document.getElementById(str);\n    }\n\n    /**\n     * TODO: will use same method of app.js\n     * @deprecated\n     */\n    public static hide(node) {\n        node.style.display = 'none';\n\n        return this;\n    }\n\n    /**\n     * TODO: will use same method of app.js\n     * @deprecated\n     */\n    public static show(node) {\n        node.style.display = 'block';\n\n        return this;\n    }\n\n    /**\n     * Escape < and > (for code output)\n     *\n     * @param str {string} - a string with < and >\n     * @returns {string} - a string with escaped < and >\n     */\n    public static encode(str) {\n        return str.replace(/</g, '&lt;').replace(/>/g, '&gt;');\n    }\n\n    /**\n     * TODO: will use same method of app.js\n     * @deprecated\n     */\n    public static foreach(arr, func) {\n        for (var i = 0, count = arr.length; i < count; i++) {\n            func(arr[i], i);\n        }\n    }\n\n    /**\n     * TODO: will use same method of app.js\n     * @deprecated\n     */\n    public static foreachReverse(arr, func) {\n        for (var i = arr.length - 1; i >= 0; i--) {\n            func(arr[i], i);\n        }\n    }\n\n    /**\n     * TODO: will use same method of app.js\n     * @deprecated\n     */\n    public static stopEvent(e) {\n        e.stopPropagation();\n        e.preventDefault();\n\n        return this;\n    }\n}","import {Utils} from './utils.class';\n\nexport class Help {\n    public block: any;\n    public overlay: any;\n    public close_button: any;\n\n    constructor() {\n        this.block = Utils.id('help');\n        // console.log('this.block', this.block);\n        this.overlay = Utils.id('overlay');\n        this.close_button = this.block.querySelector('.close_button');\n\n        this.overlay.addEventListener('click', this.hide.bind(this), false);\n        this.close_button.addEventListener('click', this.hide.bind(this), false);\n    }\n\n    public hide() {\n        Utils.hide(this.block);\n        Utils.hide(this.overlay);\n    }\n\n    public show() {\n        Utils.show(this.block);\n        Utils.show(this.overlay);\n    }\n\n}","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __createBinding(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (p !== \"default\" && !exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n","export class Area {\n    public static app: any;\n    public static SVG_NS: string = 'http://www.w3.org/2000/svg';\n    public static HTML: string = 'http://www.w3.org/1999/xhtml';\n    public static CLASS_NAMES: any = {\n        SELECTED: 'selected',\n        WITH_HREF: 'with_href'\n    };\n\n    protected type: any;\n    protected attributes: any;\n\n    protected _params: any;\n\n    protected _groupEl: any;\n    protected _el: any;\n    protected _helpers: any;\n\n    public delta: any;\n\n    public href: string;\n    public alt: string;\n    public title: string;\n\n\n    constructor(coords: any, type?: any) {\n        // Public properties:\n        this.type = type;\n        this.attributes = {\n            href: '',\n            alt: '',\n            title: ''\n        };\n\n        // Private properties:\n        this._params = {};\n\n        // the g-element, it contains this area and helpers elements\n        this._groupEl = document.createElementNS(Area.SVG_NS, 'g');\n        Area.app.addNodeToSvg(this._groupEl);\n\n        // Todo: remove this fielf from DOM-element\n        /* Link to parent object */\n        this._groupEl.obj = this;\n\n        // svg-dom-element of area\n        this._el = null;\n\n        // Array/object with all helpers of area\n        this._helpers = {}; // or []\n    }\n\n    public testCoords() {\n        throw new Error('This is abstract method');\n    }\n\n    public setCoords(params?: any) {\n        throw new Error('This is abstract method');\n    }\n\n    public redraw(params?: any) {\n        throw new Error('This is abstract method');\n    }\n\n    public remove() {\n        Area.app.removeNodeFromSvg(this._groupEl);\n    }\n\n    public select() {\n        this._el.classList.add(Area.CLASS_NAMES.SELECTED);\n        return this;\n    }\n\n    public deselect() {\n        this._el.classList.remove(Area.CLASS_NAMES.SELECTED);\n        return this;\n    }\n\n    public with_href() {\n        this._el.classList.add(Area.CLASS_NAMES.WITH_HREF);\n        return this;\n    }\n\n    public without_href() {\n        this._el.classList.remove(Area.CLASS_NAMES.WITH_HREF);\n        return this;\n    }\n\n    public setInfoAttributes(params: any) {\n        if (params.href) {\n            this.attributes.href = params.href;\n        }\n\n        if (params.alt) {\n            this.attributes.alt = params.alt;\n        }\n\n        if (params.title) {\n            this.attributes.title = params.title;\n        }\n    }\n\n    public toJSON(): any {\n        return {\n            // type: this._type,//?????\n            coords: this._params,\n            attributes: this.attributes\n        };\n    }\n}","import {Area} from './area.class';\n\n/**\n * The constructor of helpers points\n *\n * @constructor\n * @param node {parentNode} - a node for inserting helper\n * @param x {number} - x - coordinate\n * @param y {number} - y - coordinate\n * @param action {string} - an action by click of this helper\n */\nexport class Helper {\n    public static SIZE: number = 5;\n    public static SIZENum: number = 15;\n    public static OFFSET: number = -Math.ceil(Helper.SIZE / 2);\n    public static CLASS_NAME: string = 'helper';\n    public static ACTIONS_TO_CURSORS: any = {\n        'move': 'move',\n        'editLeft': 'e-resize',\n        'editRight': 'w-resize',\n        'editTop': 'n-resize',\n        'editBottom': 's-resize',\n        'editTopLeft': 'nw-resize',\n        'editTopRight': 'ne-resize',\n        'editBottomLeft': 'sw-resize',\n        'editBottomRight': 'se-resize',\n        'pointMove': 'pointer',\n        'number': 'default'\n    };\n\n    private _el: any;\n\n    constructor(node: any, x: number, y: number, action: string) {\n        if (action == 'number') {\n            this._el = document.createElementNS(Area.SVG_NS, 'text');\n        } else {\n            this._el = document.createElementNS(Area.SVG_NS, 'rect');\n        }\n\n\n        this._el.classList.add(Helper.CLASS_NAME);\n        if (action == 'number') {\n            //this._el.textContent = 'Test';\n            this._el.setAttribute('height', Helper.SIZENum);\n            this._el.setAttribute('width', Helper.SIZENum);\n            this._el.setAttribute('x', x + Helper.OFFSET);\n            this._el.setAttribute('y', y + Helper.OFFSET);\n        } else {\n            this._el.setAttribute('height', Helper.SIZE);\n            this._el.setAttribute('width', Helper.SIZE);\n            this._el.setAttribute('x', x + Helper.OFFSET);\n            this._el.setAttribute('y', y + Helper.OFFSET);\n        }\n\n        node.appendChild(this._el);\n\n        this._el.action = action;\n        this._el.classList.add(Helper.ACTIONS_TO_CURSORS[action]);\n    }\n\n    public setCoords(x: number, y: number) {\n        this._el.setAttribute('x', x + Helper.OFFSET);\n        this._el.setAttribute('y', y + Helper.OFFSET);\n\n        return this;\n    }\n\n    public setNumber(id: number) {\n        this._el.textContent = id + 1;\n    }\n\n    public setId(id: number) {\n        this._el.n = id;\n        return this;\n    }\n}","import {Area} from './area.class';\nimport {Helper} from './helper.class';\nimport {Utils} from './utils.class';\n\n/**\n * The constructor for rectangles\n *\n * Initial state:\n * (x, y) -----\n * |          |\n * -----------\n * with width = 0 and height = 0\n *\n * @constructor\n * @param coords {Object} - coordinates of the begin point, e.g. {x: 100, y: 200}\n */\nexport class Rectangle extends Area {\n    public attributes: any;\n\n    constructor(coords: any, type?: any) {\n        super(coords, 'rectangle');\n\n        /**\n         * @namespace\n         * @property {number} x - Distance from the left edge of the image to the left side of the rectangle\n         * @property {number} y - Distance from the top edge of the image to the top side of the rectangle\n         * @property {number} width - Width of rectangle\n         * @property {number} height - Height of rectangle\n         */\n        this._params = {\n            x: coords.x,\n            y: coords.y,\n            width: 0,\n            height: 0\n        };\n\n        this._el = document.createElementNS(Area.SVG_NS, 'rect');\n        this._groupEl.appendChild(this._el);\n\n        var x = coords.x - this._params.width / 2,\n            y = coords.y - this._params.height / 2;\n\n        this._helpers = {\n            number: new Helper(this._groupEl, x, y, 'number'),\n            center: new Helper(this._groupEl, x, y, 'move'),\n            top: new Helper(this._groupEl, x, y, 'editTop'),\n            bottom: new Helper(this._groupEl, x, y, 'editBottom'),\n            left: new Helper(this._groupEl, x, y, 'editLeft'),\n            right: new Helper(this._groupEl, x, y, 'editRight'),\n            topLeft: new Helper(this._groupEl, x, y, 'editTopLeft'),\n            topRight: new Helper(this._groupEl, x, y, 'editTopRight'),\n            bottomLeft: new Helper(this._groupEl, x, y, 'editBottomLeft'),\n            bottomRight: new Helper(this._groupEl, x, y, 'editBottomRight')\n        };\n        this._helpers.number.setNumber(coords.n);\n        this.select().redraw();\n\n        /* Add this object to array of all objects */\n        Area.app.addObject(this);\n    }\n\n\n    /**\n     * Set attributes for svg-elements of area by new parameters\n     * -----top-----\n     * |           |\n     * ---center_y--\n     * |           |\n     * ---bottom----\n     */\n    public setSVGAttributes(params: any) {\n        this._el.setAttribute('x', params.x);\n        this._el.setAttribute('y', params.y);\n        this._el.setAttribute('width', params.width);\n        this._el.setAttribute('height', params.height);\n\n        var top = params.y,\n            center_y = params.y + params.height / 2,\n            bottom = params.y + params.height,\n            left = params.x,\n            center_x = params.x + params.width / 2,\n            right = params.x + params.width;\n\n        this._helpers.number.setCoords(left, top - 5);\n        this._helpers.center.setCoords(center_x, center_y);\n        this._helpers.top.setCoords(center_x, top);\n        this._helpers.bottom.setCoords(center_x, bottom);\n        this._helpers.left.setCoords(left, center_y);\n        this._helpers.right.setCoords(right, center_y);\n        this._helpers.topLeft.setCoords(left, top);\n        this._helpers.topRight.setCoords(right, top);\n        this._helpers.bottomLeft.setCoords(left, bottom);\n        this._helpers.bottomRight.setCoords(right, bottom);\n        return this;\n    }\n\n    public redraw(params?: any) {\n        this.setSVGAttributes(params ? params : this._params);\n        return this;\n    }\n\n    public setParams(params: any) {\n        this._params.x = params.x;\n        this._params.y = params.y;\n        this._params.width = params.width;\n        this._params.height = params.height;\n\n        return this;\n    }\n\n    public getNormalizedCoords() {\n\n    }\n\n    public dynamicDraw(x1: number, y1: number, isSquare?: boolean) {\n        var x0 = this._params.x,\n            y0 = this._params.y,\n            new_x,\n            new_y,\n            new_width,\n            new_height,\n            delta,\n            temp_params;\n\n        new_width = Math.abs(x1 - x0);\n        new_height = Math.abs(y1 - y0);\n\n        if (isSquare) {\n            delta = new_width - new_height;\n            if (delta > 0) {\n                new_width = new_height;\n            } else {\n                new_height = new_width;\n            }\n        }\n\n        if (x0 > x1) {\n            new_x = x1;\n            if (isSquare && delta > 0) {\n                new_x = x1 + Math.abs(delta);\n            }\n        } else {\n            new_x = x0;\n        }\n\n        if (y0 > y1) {\n            new_y = y1;\n            if (isSquare && delta < 0) {\n                new_y = y1 + Math.abs(delta);\n            }\n        } else {\n            new_y = y0;\n        }\n\n        temp_params = {\n            x: new_x,\n            y: new_y,\n            width: new_width,\n            height: new_height\n        };\n\n        this.setSVGAttributes(temp_params);\n\n        return temp_params;\n    }\n\n\n    public onProcessDrawing(e: any) {\n        var coords = Utils.getRightCoords(e.pageX, e.pageY);\n\n        this.dynamicDraw(coords.x, coords.y, e.shiftKey);\n    }\n\n    public onStopDrawing(e: any) {\n        var coords = Utils.getRightCoords(e.pageX, e.pageY);\n\n        this.setParams(this.dynamicDraw(coords.x, coords.y, e.shiftKey)).deselect();\n\n        Area.app.removeAllEvents()\n            .setIsDraw(false)\n            .resetNewArea();\n    }\n\n    public move(dx: number, dy: number) { //offset x and y\n        var temp_params = Object.create(this._params);\n\n        temp_params.x += dx;\n        temp_params.y += dy;\n\n        return temp_params;\n    }\n\n\n    /**\n     * Changes area parameters by editing type and offsets\n     *\n     * @param {String} editingType - A type of editing\n     * @returns {Object} - Object with changed parameters of area\n     */\n    public edit(editingType: string, dx: number, dy: number) {\n        var tempParams = Object.assign({}, this._params);\n\n        switch (editingType) {\n            case 'move':\n                tempParams.x += dx;\n                tempParams.y += dy;\n                break;\n\n            case 'editLeft':\n                tempParams.x += dx;\n                tempParams.width -= dx;\n                break;\n\n            case 'editRight':\n                tempParams.width += dx;\n                break;\n\n            case 'editTop':\n                tempParams.y += dy;\n                tempParams.height -= dy;\n                break;\n\n            case 'editBottom':\n                tempParams.height += dy;\n                break;\n\n            case 'editTopLeft':\n                tempParams.x += dx;\n                tempParams.y += dy;\n                tempParams.width -= dx;\n                tempParams.height -= dy;\n                break;\n\n            case 'editTopRight':\n                tempParams.y += dy;\n                tempParams.width += dx;\n                tempParams.height -= dy;\n                break;\n\n            case 'editBottomLeft':\n                tempParams.x += dx;\n                tempParams.width -= dx;\n                tempParams.height += dy;\n                break;\n\n            case 'editBottomRight':\n                tempParams.width += dx;\n                tempParams.height += dy;\n                break;\n        }\n\n        return tempParams;\n    }\n\n    public dynamicEdit(temp_params: any, saveProportions: any) {\n        if (temp_params.width < 0) {\n            temp_params.width = Math.abs(temp_params.width);\n            temp_params.x -= temp_params.width;\n        }\n\n        if (temp_params.height < 0) {\n            temp_params.height = Math.abs(temp_params.height);\n            temp_params.y -= temp_params.height;\n        }\n\n        if (saveProportions) {\n            var proportions = this._params.width / this._params.height,\n                new_proportions = temp_params.width / temp_params.height,\n                delta = new_proportions - proportions,\n                x0 = this._params.x,\n                y0 = this._params.y,\n                x1 = temp_params.x,\n                y1 = temp_params.y;\n\n            if (delta > 0) {\n                temp_params.width = Math.round(temp_params.height * proportions);\n            } else {\n                temp_params.height = Math.round(temp_params.width / proportions);\n            }\n\n        }\n\n        this.setSVGAttributes(temp_params);\n\n        return temp_params;\n    }\n\n    public onProcessEditing(e: any) {\n        return this.dynamicEdit(\n            this.edit(\n                Area.app.getEditType(),\n                e.pageX - this.delta.x,\n                e.pageY - this.delta.y\n            ),\n            e.shiftKey\n        );\n    }\n\n    public onStopEditing(e: any) {\n\n        this.setParams(this.onProcessEditing(e));\n        Area.app.removeAllEvents()\n            .setIsDraw(false)\n            .resetNewArea();\n    }\n\n    public toString() { //to html map area code\n        var x2 = this._params.x + this._params.width,\n            y2 = this._params.y + this._params.height;\n\n        return '<area shape=\"rect\" coords=\"' // TODO: use template engine\n            + this._params.x + ', '\n            + this._params.y + ', '\n            + x2 + ', '\n            + y2\n            + '\"'\n            + (this.href ? ' href=\"' + this.href + '\"' : '')\n            + (this.alt ? ' alt=\"' + this.alt + '\"' : '')\n            + (this.title ? ' title=\"' + this.title + '\"' : '')\n            + ' />';\n    }\n\n    public toJSON(): any {\n        return {\n            type: 'rectangle',\n            coords: [\n                this._params.x,\n                this._params.y,\n                this._params.x + this._params.width,\n                this._params.y + this._params.height\n            ],\n            href: this.attributes.href,\n            alt: this.attributes.alt,\n            title: this.attributes.title\n        };\n    }\n\n    /**\n     * Returns true if coords array is valid for rectangles and false otherwise\n     *\n     * @static\n     * @param coords {Array} - coords for new rectangle as array\n     * @return {boolean}\n     */\n    public static testCoords(coords) {\n        return coords.length === 4;\n    }\n\n    public static createFromSaved(params: any) {\n        if (!this.testCoords(params.coords)) {\n            return;\n        }\n\n        Area.app.setIsDraw(true);\n\n        var area = new Rectangle({\n            x: params.coords[0],\n            y: params.coords[1],\n            n: params.number\n        });\n\n        area.setParams(area.dynamicDraw(params.coords[2], params.coords[3])).deselect();\n\n        Area.app.setIsDraw(false)\n            .resetNewArea();\n\n        area.setInfoAttributes(params);\n    }\n    /**\n     * Creates new rectangle and add drawing handlers for DOM-elements\n     *\n     * @param coords {Object} coords\n     * @returns created rectangle\n     */\n    public static  createAndStartDrawing(coords) {\n        coords.n = Area.app.getAreas().length;\n        var newArea = new Rectangle(coords);\n\n        Area.app.addEvent(Area.app.domElements.container, 'mousemove', newArea.onProcessDrawing.bind(newArea))\n            .addEvent(Area.app.domElements.container, 'click', newArea.onStopDrawing.bind(newArea));\n\n        return newArea;\n    }\n}","import {Area} from './area.class';\nimport {Helper} from './helper.class';\nimport {Utils} from './utils.class';\n\n/**\n * The constructor for circles\n *\n * Initial state:\n *      ----\n *  /         \\\n * |  (x, y)  |\n * \\         /\n *    ----\n * with radius = 0\n *\n * @constructor\n * @param coords {Object} - coordinates of the begin pointer, e.g. {x: 100, y: 200}\n */\nexport class Circle extends Area {\n\n    constructor(coords: any, type?: any) {\n        super(coords, 'circle');\n\n        /**\n         * @namespace\n         * @property {number} cx - Distance from the left edge of the image to the center of the circle\n         * @property {number} cy - Distance from the top edge of the image to the center of the circle\n         * @property {number} radius - Radius of the circle\n         */\n        this._params = {\n            cx: coords.x,\n            cy: coords.y,\n            radius: 0\n        }\n\n        this._el = document.createElementNS(Area.SVG_NS, 'circle');\n        this._groupEl.appendChild(this._el);\n\n        this._helpers = { //array of all helpers-rectangles\n            number: new Helper(this._groupEl, coords.x, coords.y, 'number'),\n            center: new Helper(this._groupEl, coords.x, coords.y, 'move'),\n            top: new Helper(this._groupEl, coords.x, coords.y, 'editTop'),\n            bottom: new Helper(this._groupEl, coords.x, coords.y, 'editBottom'),\n            left: new Helper(this._groupEl, coords.x, coords.y, 'editLeft'),\n            right: new Helper(this._groupEl, coords.x, coords.y, 'editRight')\n        }\n        this._helpers.number.setNumber(coords.n);\n        this.select().redraw();\n\n        Area.app.addObject(this); //add this object to array of all objects\n    }\n\n    public setSVGAttributes(params) {\n        this._el.setAttribute('cx', params.cx);\n        this._el.setAttribute('cy', params.cy);\n        this._el.setAttribute('r', params.radius);\n\n        this._helpers.number.setCoords(params.cx, params.cy - params.radius - 5);\n        this._helpers.center.setCoords(params.cx, params.cy);\n        this._helpers.top.setCoords(params.cx, params.cy - params.radius);\n        this._helpers.right.setCoords(params.cx + params.radius, params.cy);\n        this._helpers.bottom.setCoords(params.cx, params.cy + params.radius);\n        this._helpers.left.setCoords(params.cx - params.radius, params.cy);\n\n        return this;\n    }\n\n    public setParams(params) {\n        this._params.cx = params.cx;\n        this._params.cy = params.cy;\n        this._params.radius = params.radius;\n\n        return this;\n    }\n\n    public dynamicDraw(x1, y1) {\n        var x0 = this._params.cx,\n            y0 = this._params.cy,\n            dx,\n            dy,\n            radius,\n            temp_params;\n\n        x1 = x1 || x0;\n        y1 = y1 || y0;\n\n        dx = Math.abs(x0 - x1);\n        dy = Math.abs(y0 - y1);\n        radius = Math.round(Math.sqrt(dx * dx + dy * dy));\n\n        temp_params = {\n            /* params */\n            cx: x0,\n            cy: y0,\n            radius: radius\n        }\n\n        this.setSVGAttributes(temp_params);\n\n        return temp_params;\n    }\n\n    public onProcessDrawing(e) {\n        var coords = Utils.getRightCoords(e.pageX, e.pageY);\n\n        this.dynamicDraw(coords.x, coords.y);\n    }\n\n    public onStopDrawing(e) {\n        var coords = Utils.getRightCoords(e.pageX, e.pageY);\n\n        this.setParams(this.dynamicDraw(coords.x, coords.y)).deselect();\n\n        Area.app.removeAllEvents()\n            .setIsDraw(false)\n            .resetNewArea();\n    }\n\n    public edit(editingType, dx, dy) {\n        var tempParams = Object.assign({}, this._params);\n        switch (editingType) {\n            case 'move':\n                tempParams.cx += dx;\n                tempParams.cy += dy;\n                break;\n\n            case 'editTop':\n                tempParams.radius -= dy;\n                break;\n\n            case 'editBottom':\n                tempParams.radius += dy;\n                break;\n\n            case 'editLeft':\n                tempParams.radius -= dx;\n                break;\n\n            case 'editRight':\n                tempParams.radius += dx;\n                break;\n        }\n        return tempParams;\n    }\n\n    public move(dx, dy) { //offset x and y\n        var temp_params = Object.create(this._params);\n\n        temp_params.cx += dx;\n        temp_params.cy += dy;\n\n        return temp_params;\n    }\n\n    public dynamicEdit(temp_params) {\n        if (temp_params.radius < 0) {\n            temp_params.radius = Math.abs(temp_params.radius);\n        }\n        this.setSVGAttributes(temp_params);\n\n        return temp_params;\n    }\n\n    public onProcessEditing(e) {\n        var editType = Area.app.getEditType();\n        this.dynamicEdit(\n            this.edit(editType, e.pageX - this.delta.x, e.pageY - this.delta.y)\n        );\n    }\n\n    public onStopEditing(e) {\n        var editType = Area.app.getEditType();\n\n        this.setParams(\n            this.dynamicEdit(\n                this.edit(editType, e.pageX - this.delta.x, e.pageY - this.delta.y)\n            )\n        );\n\n        Area.app.removeAllEvents();\n    }\n\n    public toString() { //to html map area code\n        return '<area shape=\"circle\" coords=\"'\n            + this._params.cx + ', '\n            + this._params.cy + ', '\n            + this._params.radius\n            + '\"'\n            + (this.href ? ' href=\"' + this.href + '\"' : '')\n            + (this.alt ? ' alt=\"' + this.alt + '\"' : '')\n            + (this.title ? ' title=\"' + this.title + '\"' : '')\n            + ' />';\n    }\n\n    /**\n     * Returns true if coords array is valid for circles and false otherwise\n     *\n     * @static\n     * @param coords {Array} - coords for new circle as array\n     * @return {boolean}\n     */\n    public static testCoords(coords) {\n        return coords.length === 3;\n    }\n\n    public static createFromSaved(params) {\n        if (!this.testCoords(params.coords)) {\n            return;\n        }\n\n        Area.app.setIsDraw(true);\n        var area = new Circle({\n            x: params.coords[0],\n            y: params.coords[1],\n            n: params.number\n        });\n\n        area.setParams(area.dynamicDraw(\n            params.coords[0],\n            params.coords[1] + params.coords[2]\n        )).deselect();\n\n        Area.app.setIsDraw(false)\n            .resetNewArea();\n\n        area.setInfoAttributes(params);\n    }\n\n    public toJSON(): any {\n        return {\n            type: 'circle',\n            coords: [\n                this._params.cx,\n                this._params.cy,\n                this._params.radius\n            ],\n            href: this.attributes.href,\n            alt: this.attributes.alt,\n            title: this.attributes.title\n        }\n    }\n\n    public redraw(params?: any) {\n        this.setSVGAttributes(params ? params : this._params);\n        return this;\n    }\n\n    /**\n     * Creates new circle and add drawing handlers for DOM-elements\n     *\n     * @param coords {Object} coords\n     * @returns created circle\n     */\n    public static createAndStartDrawing(coords) {\n        coords.n = Area.app.getAreas().length;\n        var newArea = new Circle(coords);\n\n        Area.app.addEvent(Area.app.domElements.container, 'mousemove', newArea.onProcessDrawing.bind(newArea))\n            .addEvent(Area.app.domElements.container, 'click', newArea.onStopDrawing.bind(newArea));\n\n        return newArea;\n    }\n}","import {Area} from './area.class';\nimport {Helper} from './helper.class';\nimport {Utils} from './utils.class';\n\n/**\n * The constructor for polygons\n *\n * Initial state:\n *    (x, y)\n * only one point of the line\n *\n * @constructor\n * @param coords {Object} - coordinates of the begin pointer, e.g. {x: 100, y: 200}\n */\nexport class Polygon extends Area {\n\n    private selected_point: number;\n    private _polyline: any;\n\n    constructor(coords: any, type?: any) {\n        super(coords, 'polygon');\n\n        /**\n         * @namespace\n         * @property {array} points - Array of coordinates of polygon points\n         */\n        this._params = {\n            points: [coords.x, coords.y]\n        }\n\n        this._el = document.createElementNS(Area.SVG_NS, 'polyline');\n        this._groupEl.appendChild(this._el);\n\n        this._helpers = [ //array of all helpers-rectangles\n            new Helper(this._groupEl, this._params.points[0], this._params.points[1], 'number'),\n            (new Helper(this._groupEl, this._params.points[0], this._params.points[1], 'pointMove')).setId(1)\n        ];\n        this._helpers[0].setNumber(coords.n);\n        this.selected_point = -1;\n\n        this.select().redraw();\n\n        Area.app.addObject(this); //add this object to array of all objects\n    }\n\n\n    public setCoords(params?: any) {\n        var coords_values = params.points.join(' ');\n        this._el.setAttribute('points', coords_values);\n        Utils.foreach(this._helpers, function (x, i) {\n            if (x._el.action == 'number') {\n                x.setCoords(params.points[0], params.points[1]);\n            } else {\n                i = i - 1;\n                x.setCoords(params.points[2 * i], params.points[2 * i + 1]);\n            }\n            //x.setCoords(params.points[2 * i], params.points[2 * i + 1]);\n        });\n\n        return this;\n    }\n\n    public setSVGAttributes(params) {\n        var coords_values = params.points.join(' ');\n        this._el.setAttribute('points', coords_values);\n\n        Utils.foreach(this._helpers, function (helper, i) {\n            if (helper._el.action == 'number') {\n                helper.setCoords(params.points[0], params.points[1]);\n            } else {\n                i = i - 1;\n                helper.setCoords(params.points[2 * i], params.points[2 * i + 1]);\n            }\n        });\n        return this;\n    }\n\n    public setParams(arr) {\n        if (arr.isArray) {\n            this._params.points = Array.prototype.slice.call(arr);\n        } else {\n            this._params.points = Array.prototype.slice.call(arr.points);\n        }\n        return this;\n    }\n\n    public addPoint(x, y) {\n        var helper = new Helper(this._groupEl, x, y, 'pointMove');\n        helper.setId(this._helpers.length);\n        this._helpers.push(helper);\n        this._params.points.push(x, y);\n        this.redraw();\n\n        return this;\n    }\n\n    public right_angle(x, y) {\n        var old_x = this._params.points[this._params.points.length - 2],\n            old_y = this._params.points[this._params.points.length - 1],\n            dx = x - old_x,\n            dy = -(y - old_y),\n            tan = dy / dx; //tangens\n\n        if (dx > 0 && dy > 0) {\n            if (tan > 2.414) {\n                x = old_x;\n            } else if (tan < 0.414) {\n                y = old_y;\n            } else {\n                Math.abs(dx) > Math.abs(dy) ? x = old_x + dy : y = old_y - dx;\n            }\n        } else if (dx < 0 && dy > 0) {\n            if (tan < -2.414) {\n                x = old_x;\n            } else if (tan > -0.414) {\n                y = old_y;\n            } else {\n                Math.abs(dx) > Math.abs(dy) ? x = old_x - dy : y = old_y + dx;\n            }\n        } else if (dx < 0 && dy < 0) {\n            if (tan > 2.414) {\n                x = old_x;\n            } else if (tan < 0.414) {\n                y = old_y;\n            } else {\n                Math.abs(dx) > Math.abs(dy) ? x = old_x + dy : y = old_y - dx;\n            }\n        } else if (dx > 0 && dy < 0) {\n            if (tan < -2.414) {\n                x = old_x;\n            } else if (tan > -0.414) {\n                y = old_y;\n            } else {\n                Math.abs(dx) > Math.abs(dy) ? x = old_x - dy : y = old_y + dx;\n            }\n        }\n\n        return {\n            x: x,\n            y: y\n        }\n    }\n\n    public dynamicDraw(x, y, right_angle) {\n        var temp_params = {\n            points: [].concat(this._params.points)\n        }\n\n        if (right_angle) {\n            var right_coords = this.right_angle(x, y);\n            x = right_coords.x;\n            y = right_coords.y;\n        }\n\n        temp_params.points.push(x, y);\n\n        this.redraw(temp_params);\n\n        return temp_params;\n    }\n\n    public onProcessDrawing(e) {\n        var coords = Utils.getRightCoords(e.pageX, e.pageY);\n\n        this.dynamicDraw(coords.x, coords.y, e.shiftKey);\n    }\n\n    public onAddPointDrawing(e) {\n        var coords = Utils.getRightCoords(e.pageX, e.pageY);\n\n        if (e.shiftKey) {\n            coords = this.right_angle(coords.x, coords.y);\n        }\n\n        this.addPoint(coords.x, coords.y);\n    }\n\n    public onStopDrawing(e) {\n        if (e.type == 'click' || (e.type == 'keydown' && e.keyCode == 13)) {\n            if (this._params.points.length >= 6) {//>= 3 points for polygon\n                this._polyline = this._el;\n                this._el = document.createElementNS(Area.SVG_NS, 'polygon');\n                this._groupEl.replaceChild(this._el, this._polyline);\n                this.redraw(this._params).deselect();\n                delete(this._polyline);\n\n                Area.app.removeAllEvents()\n                    .setIsDraw(false)\n                    .resetNewArea();\n            }\n        }\n        e.stopPropagation();\n    }\n\n    public redraw(params?: any) {\n        this.setSVGAttributes(params ? params : this._params);\n        return this;\n    }\n\n    public move(x, y) { //offset x and y\n        //var temp_params = Object.create(this._params);\n        var temp_params = this._params;\n\n        for (var i = 0, count = this._params.points.length; i < count; i++) {\n            this._params.points[i] += (i % 2 ? y : x);\n        }\n        return temp_params;\n    }\n\n    public pointMove(x, y) {//offset x and y\n        if (this.selected_point == 1) {\n            this._params.points[0] += x;\n            this._params.points[1] += y;\n        } else {\n            this._params.points[2 * this.selected_point - 2] += x;\n            this._params.points[2 * this.selected_point - 1] += y;\n        }\n\n        return this._params;\n    }\n\n    public dynamicEdit(temp_params) {\n        this.setCoords(temp_params);\n\n        return temp_params;\n    }\n\n    public onProcessEditing(e) {\n        var editType = Area.app.getEditType();\n        if (typeof this[editType] === 'function') {\n            this.dynamicEdit(\n                this[editType](e.pageX - this.delta.x, e.pageY - this.delta.y)\n            );\n            this.delta.x = e.pageX;\n            this.delta.y = e.pageY;\n        }\n    }\n\n    public onStopEditing(e) {\n        var editType = Area.app.getEditType();\n        this.setParams(\n            this.dynamicEdit(\n                this[editType](e.pageX - this.delta.x, e.pageY - this.delta.y)\n            )\n        );\n        Area.app.removeAllEvents();\n    }\n\n    public toString() { //to html map area code\n        for (var i = 0, count = this._params.points.length, str = ''; i < count; i++) {\n            str += this._params.points[i];\n            if (i != count - 1) {\n                str += ', ';\n            }\n        }\n\n        return '<area shape=\"poly\" coords=\"'\n            + str\n            + '\"'\n            + (this.href ? ' href=\"' + this.href + '\"' : '')\n            + (this.alt ? ' alt=\"' + this.alt + '\"' : '')\n            + (this.title ? ' title=\"' + this.title + '\"' : '')\n            + ' />';\n    }\n\n    /**\n     * Returns true if coords array is valid for polygons and false otherwise\n     *\n     * @static\n     * @param coords {Array} - coords for new polygon as array\n     * @return {boolean}\n     */\n    public static testCoords(coords) {\n        return coords.length >= 6 && coords.length % 2 === 0;\n    }\n\n    public static createFromSaved(params) {\n        if (!this.testCoords(params.coords)) {\n            return;\n        }\n\n        Area.app.setIsDraw(true);\n\n        var area = new Polygon({\n            x: params.coords[0],\n            y: params.coords[1],\n            n: params.number\n        });\n\n        for (var i = 2, c = params.coords.length; i < c; i += 2) {\n            area.addPoint(params.coords[i], params.coords[i + 1]);\n        }\n\n        area._polyline = area._el;\n        area._el = document.createElementNS(Area.SVG_NS, 'polygon');\n        area._groupEl.replaceChild(area._el, area._polyline);\n\n        area.setCoords(area._params).deselect();\n        delete(area._polyline);\n\n        Area.app.setIsDraw(false)\n            .resetNewArea();\n\n        area.setInfoAttributes(params);\n\n    }\n\n    /**\n     * Creates new polygon and add drawing handlers for DOM-elements\n     *\n     * @param coords {Object} coords\n     * @returns created polygon\n     */\n    public static createAndStartDrawing(coords) {\n        coords.n = Area.app.getAreas().length;\n        var newArea = new Polygon(coords);\n\n        Area.app.addEvent(Area.app.domElements.container, 'mousemove', newArea.onProcessDrawing.bind(newArea))\n            .addEvent(Area.app.domElements.container, 'click', newArea.onAddPointDrawing.bind(newArea))\n            .addEvent(document, 'keydown', newArea.onStopDrawing.bind(newArea))\n            .addEvent(newArea._helpers[0]._el, 'click', newArea.onStopDrawing.bind(newArea));\n\n        return newArea;\n    }\n\n    public toJSON(): any {\n        return {\n            type: 'polygon',\n            coords: this._params.points,\n            href: this.attributes.href,\n            alt: this.attributes.alt,\n            title: this.attributes.title\n        }\n    }\n}","import {Rectangle} from './rectangle.class';\nimport {Circle} from './circle.class';\nimport {Polygon} from './polygon.class';\n\nexport class AreaFactory {\n    public static CONSTRUCTORS: any = {\n        rectangle: Rectangle,\n        circle: Circle,\n        polygon: Polygon\n    };\n}","export class AppEvent {\n    public target: any;\n    public func: any;\n    public eventType: any;\n\n    constructor(target: any, eventType: any, func: any,) {\n        this.target = target;\n        this.eventType = eventType;\n        this.func = func;\n\n        target.addEventListener(eventType, func, false);\n    }\n\n    public remove() {\n        this.target.removeEventListener(this.eventType, this.func, false);\n    }\n}","import {Utils} from './utils.class';\nimport {Area} from './area.class';\nimport {EditorApp} from './editor-app.class';\n\n/* Buttons and actions */\nexport class Buttons {\n    public all = Utils.id('nav').getElementsByTagName('li');\n    public rectangle = Utils.id('rectangle');\n    public circle = Utils.id('circle');\n    public polygon = Utils.id('polygon');\n    public edit = Utils.id('edit');\n    public clear = Utils.id('clear');\n    public to_html = Utils.id('to_html');\n    public show_help = Utils.id('show_help');\n\n\n    constructor(private app: EditorApp) {\n        this.rectangle.addEventListener('click', this.onShapeButtonClick.bind(this), false);\n        this.circle.addEventListener('click', this.onShapeButtonClick.bind(this), false);\n        this.polygon.addEventListener('click', this.onShapeButtonClick.bind(this), false);\n        this.clear.addEventListener('click', this.onClearButtonClick.bind(this), false);\n        this.to_html.addEventListener('click', this.onToHtmlButtonClick.bind(this), false);\n        this.edit.addEventListener('click', this.onEditButtonClick.bind(this), false);\n        this.show_help.addEventListener('click', this.onShowHelpButtonClick.bind(this), false);\n    }\n\n    public deselectAll() {\n        Utils.foreach(this.all, function (x) {\n            x.classList.remove(Area.CLASS_NAMES.SELECTED);\n        });\n    }\n\n    public selectOne(button: any) {\n        this.deselectAll();\n        button.classList.add(Area.CLASS_NAMES.SELECTED);\n    }\n\n    public onShapeButtonClick(e) {\n        e.preventDefault();\n        var target = e.target.id ? e.target : e.target.parentNode;\n\n        // console.log('onShapeButtonClick', e, this, target, target.id);\n\n        this.onSetInvalid();\n\n        this.app.setMode('drawing')\n            .setDrawClass()\n            .setShape(target.id)\n            .deselectAll()\n            .hidePreview();\n        // this.app.info.unload();\n        this.selectOne(target);\n    }\n\n    public onClearButtonClick(e) {\n        e.preventDefault();\n        // console.log('onClearButtonClick', e, this);\n\n        // Clear all\n        if (confirm('Clear all?')) {\n            this.onSetInvalid();\n\n            this.app.setMode(null)\n                .setDefaultClass()\n                .setShape(null)\n                .clear()\n                .hidePreview();\n            this.deselectAll();\n        }\n    }\n\n\n    public onToHtmlButtonClick(e) {\n        var answers = this.app.getAreas();\n        var scale = 1;\n        if (this.app.state.image.width > this.app.domElements.img.clientWidth) {\n            scale = Number((this.app.state.image.width / this.app.domElements.img.clientWidth).toFixed(3));\n        } else {\n            scale = 1;\n        }\n        var resultsAnswers: any[] = [];\n        answers.forEach(function (item, i, arr) {\n            var imgMapData = item.toJSON();\n            imgMapData.coords.forEach(function (item, i, arr) {\n                imgMapData.coords[i] = Math.round(item * scale);\n            });\n            resultsAnswers.push({\n                body: item.attributes.title,\n                is_right: (item.attributes.alt == '1') ? true : false,\n                img_map: JSON.stringify(imgMapData)\n            });\n        });\n\n        this.onData(resultsAnswers, this.app.getAreasJSON(scale));\n\n        // Generate html code only\n        e.preventDefault();\n    }\n\n\n    public onEditButtonClick(e) {\n        e.preventDefault();\n\n        this.onSetInvalid();\n\n        if (this.app.getMode() === 'editing') {\n            this.app.setMode(null)\n                .setDefaultClass()\n                .deselectAll();\n            this.deselectAll();\n            Utils.show(this.app.domElements.svg);\n        } else {\n            this.app.setShape(null)\n                .setMode('editing')\n                .setEditClass();\n            this.selectOne(this.edit);\n        }\n        this.app.hidePreview();\n    }\n\n    public onData(answers: any[], areas: any) {\n\n    }\n\n    public onSetInvalid() {\n\n    }\n\n    public onShowHelpButtonClick(e) {\n        this.app.help.show();\n        e.preventDefault();\n    }\n}\n","import {Utils} from './utils.class';\n// import {Info} from './info.class';\n// import {Code} from './code.class';\nimport {Help} from './help.class';\nimport {AreaFactory} from './area-factory.class';\nimport {AppEvent} from './app-event.class';\nimport {Buttons} from './buttons.class';\n\nexport class CursorPositionInfo {\n    private _coords_info: any = Utils.id('coords');\n\n    public set(coords: any) {\n        this._coords_info.innerHTML = 'x: ' + coords.x + ', ' + 'y: ' + coords.y;\n    }\n\n    public empty() {\n        this._coords_info.innerHTML = '';\n    }\n}\n\n\nexport class EditorApp {\n    public domElements: any = {\n        wrapper: Utils.id('wrapper'),\n        svg: Utils.id('svg'),\n        img: Utils.id('img'),\n        container: Utils.id('image'),\n        map: null,\n        editor: Utils.id('editor')\n    };\n\n    public img: any = Utils.id('img');\n\n    public state: any = {\n        offset: {\n            x: 0,\n            y: 0\n        },\n        appMode: null, // drawing || editing || preview\n        currentType: null,\n        editType: null,\n        newArea: null,\n        selectedArea: null,\n        areas: [],\n        events: [],\n        isDraw: false,\n        image: {\n            src: null,\n            filename: null,\n            width: 0,\n            height: 0\n        }\n    };\n\n    public static KEYS: any = {\n        F1: 112,\n        ESC: 27,\n        TOP: 38,\n        BOTTOM: 40,\n        LEFT: 37,\n        RIGHT: 39,\n        DELETE: 46,\n        I: 73,\n        S: 83,\n        C: 67\n    };\n\n    public cursor_position_info: CursorPositionInfo;\n    // public info: Info = new Info();\n    // public code: Code = new Code();\n    public help: Help = new Help();\n    public buttons: Buttons;\n\n    public filename: any = null;\n\n    constructor() {\n        /* Get offset value */\n        window.addEventListener('resize', this.recalcOffsetValues.bind(this), false);\n\n        /* Disable selection */\n        this.domElements.container.addEventListener('mousedown', (e) => {\n            e.preventDefault();\n        }, false);\n\n        /* Disable image dragging */\n        this.domElements.img.addEventListener('dragstart', (e) => {\n            e.preventDefault();\n        }, false);\n\n        this.cursor_position_info = new CursorPositionInfo();\n\n        this.domElements.container.addEventListener('mousemove', (e) => {\n            this.cursor_position_info.set(Utils.getRightCoords(e.pageX, e.pageY));\n        }, false);\n\n        this.domElements.container.addEventListener('mouseleave', () => {\n            this.cursor_position_info.empty();\n        }, false);\n\n\n        this.domElements.container.addEventListener('mousedown', this.onSvgMousedown.bind(this), false);\n        this.domElements.container.addEventListener('click', this.onSvgClick.bind(this), false);\n        this.domElements.container.addEventListener('dblclick', this.onAreaDblClick.bind(this), false);\n\n        this.domElements.editor.addEventListener('keydown', this.onDocumentKeyDown.bind(this), false);\n\n        this.buttons = new Buttons(this);\n    }\n\n    public recalcOffsetValues() {\n        this.state.offset = Utils.getOffset(this.domElements.container);\n    }\n\n    /* Add mousedown event for svg */\n    public onSvgMousedown(e: any) {\n        if (this.state.appMode === 'editing') {\n            if (e.target.parentNode.tagName === 'g') {\n                // this.info.unload();\n                this.state.selectedArea = e.target.parentNode.obj;\n                this.deselectAll();\n                this.state.selectedArea.select();\n                this.state.selectedArea.delta = {\n                    'x': e.pageX,\n                    'y': e.pageY\n                };\n\n                if (e.target.classList.contains('helper')) {\n                    var helper = e.target;\n                    this.state.editType = helper.action;\n\n                    if (helper.n >= 0) { // if typeof selected_area == polygon\n                        this.state.selectedArea.selected_point = helper.n;\n                    }\n\n                    this.addEvent(this.domElements.container,\n                        'mousemove',\n                        this.state.selectedArea.onProcessEditing.bind(this.state.selectedArea))\n                        .addEvent(this.domElements.container,\n                            'mouseup',\n                            this.state.selectedArea.onStopEditing.bind(this.state.selectedArea));\n                } else if (e.target.tagName === 'rect' || e.target.tagName === 'circle' || e.target.tagName === 'polygon') {\n                    this.state.editType = 'move';\n                    this.addEvent(this.domElements.container,\n                        'mousemove',\n                        this.state.selectedArea.onProcessEditing.bind(this.state.selectedArea))\n                        .addEvent(this.domElements.container,\n                            'mouseup',\n                            this.state.selectedArea.onStopEditing.bind(this.state.selectedArea));\n                }\n            } else {\n                this.deselectAll();\n                // this.info.unload();\n            }\n        }\n    }\n\n    /* Add click event for svg */\n    public onSvgClick(e) {\n        if (this.state.appMode === 'drawing' && !this.state.isDraw && this.state.currentType) {\n            // this.code.hide();\n            this.setIsDraw(true);\n\n            this.state.newArea = AreaFactory.CONSTRUCTORS[this.state.currentType].createAndStartDrawing(\n                Utils.getRightCoords(e.pageX, e.pageY)\n            );\n        }\n    }\n\n    /* Add dblclick event for svg */\n    public onAreaDblClick(e) {\n        if (this.state.appMode === 'editing') {\n            if (e.target.tagName === 'rect' || e.target.tagName === 'circle' || e.target.tagName === 'polygon') {\n                this.state.selectedArea = e.target.parentNode.obj;\n                // this.info.load(this.state.selectedArea, e.pageX, e.pageY);\n            }\n        }\n    }\n\n    /* Add keydown event for document */\n    public onDocumentKeyDown(e: any) {\n        var ctrlDown = e.ctrlKey || e.metaKey; // PC || Mac\n\n        switch (e.keyCode) {\n            case EditorApp.KEYS.F1:\n                this.help.show();\n                e.preventDefault();\n\n                break;\n\n            case EditorApp.KEYS.ESC:\n                this.help.hide();\n                if (this.state.isDraw) {\n                    this.state.isDraw = false;\n                    this.state.newArea.remove();\n                    this.state.areas.pop();\n                    this.removeAllEvents();\n                } else if (this.state.appMode === 'editing') {\n                    this.state.selectedArea.redraw();\n                    this.removeAllEvents();\n                }\n\n                break;\n\n            case EditorApp.KEYS.TOP:\n                if (this.state.appMode === 'editing' && this.state.selectedArea) {\n                    this.state.selectedArea.setParams(\n                        this.state.selectedArea.dynamicEdit(this.state.selectedArea.move(0, -1))\n                    );\n                    e.preventDefault();\n                }\n\n                break;\n\n            case EditorApp.KEYS.BOTTOM:\n                if (this.state.appMode === 'editing' && this.state.selectedArea) {\n                    this.state.selectedArea.setParams(\n                        this.state.selectedArea.dynamicEdit(this.state.selectedArea.move(0, 1))\n                    );\n                    e.preventDefault();\n                }\n                break;\n\n            case EditorApp.KEYS.LEFT:\n                if (this.state.appMode === 'editing' && this.state.selectedArea) {\n                    this.state.selectedArea.setParams(\n                        this.state.selectedArea.dynamicEdit(this.state.selectedArea.move(-1, 0))\n                    );\n                    e.preventDefault();\n                }\n\n                break;\n\n            case EditorApp.KEYS.RIGHT:\n                if (this.state.appMode === 'editing' && this.state.selectedArea) {\n                    this.state.selectedArea.setParams(\n                        this.state.selectedArea.dynamicEdit(this.state.selectedArea.move(1, 0))\n                    );\n                    e.preventDefault();\n                }\n\n                break;\n\n            case EditorApp.KEYS.DELETE:\n                if (this.state.appMode === 'editing' && this.state.selectedArea) {\n                    this.removeObject(this.state.selectedArea);\n                    this.state.selectedArea = null;\n                    // this.info.unload();\n                }\n\n                break;\n\n            case EditorApp.KEYS.I:\n                if (this.state.appMode === 'editing' && this.state.selectedArea) {\n                    var params = this.state.selectedArea.params,\n                        x = params.x || params.cx || params[0],\n                        y = params.y || params.cy || params[1];\n\n                    // this.info.load(this.state.selectedArea, x + this.getOffset('x'), y + this.getOffset('y'));\n                }\n\n                break;\n\n            case EditorApp.KEYS.C:\n                if (this.state.appMode === 'editing' && this.state.selectedArea && ctrlDown) {\n                    var Constructor = AreaFactory.CONSTRUCTORS[area_params.type],\n                        area_params = this.state.selectedArea.toJSON();\n\n                    if (Constructor) {\n                        Constructor.createFromSaved(area_params);\n                        this.state.selectedArea.setParams(this.state.selectedArea.move(10, 10));\n                        this.state.selectedArea.redraw();\n                    }\n                }\n\n                break;\n        }\n    }\n\n\n    public hide() {\n        Utils.hide(this.domElements.container);\n        return this;\n    }\n\n    public show() {\n        Utils.show(this.domElements.container);\n        return this;\n    }\n\n    public setDimensions(width, height) {\n        this.domElements.svg.setAttribute('width', width);\n        this.domElements.svg.setAttribute('height', height);\n        this.domElements.container.style.width = width + 'px';\n        this.domElements.container.style.height = height + 'px';\n        return this;\n    }\n\n    public onImageLoaded(state: any) {\n\n    }\n\n    public loadImage(url, width) {\n        this.domElements.img.src = url;\n        this.state.image.src = url;\n        this.state.image.width = width;\n        var tmp_arr = url.split('/');\n        this.filename = tmp_arr[tmp_arr.length - 1];\n        this.domElements.img.onload = () => {\n            this.show()\n                .setDimensions(this.domElements.img.width, this.domElements.img.height)\n                .recalcOffsetValues();\n\n            this.onImageLoaded(this.state);\n        };\n\n        this.setFilename(this.filename);\n\n        this.preview();\n\n        return this;\n    }\n\n    public preview() {\n        this.domElements.img.setAttribute('usemap', '#map');\n        this.domElements.map = document.createElement('map');\n        this.domElements.map.setAttribute('name', 'map');\n        this.domElements.container.appendChild(this.domElements.map);\n\n        // Utils.hide(this.domElements.svg);\n        // this.map.innerHTML = this.app.getHTMLCode();\n\n//     return function () {\n//         info.unload();\n//         app.onEditingProcesshape(null);\n//         Utils.hide(domElements.svg);\n//         map.innerHTML = app.getHTMLCode();\n//         code.print();\n//         return this;\n//     };\n    }\n\n    public hidePreview() {\n        Utils.show(this.domElements.svg);\n        this.domElements.map.innerHTML = '';\n        return this;\n    }\n\n    public addNodeToSvg(node) {\n        this.domElements.svg.appendChild(node);\n        return this;\n    }\n\n    public removeNodeFromSvg(node) {\n        this.domElements.svg.removeChild(node);\n        return this;\n    }\n\n    public getOffset(arg) {\n        switch (arg) {\n            case 'x':\n            case 'y':\n                return this.state.offset[arg];\n        }\n    }\n\n    public clear() {\n        //remove all areas\n        this.state.areas.length = 0;\n        while (this.domElements.svg.childNodes[0]) {\n            this.domElements.svg.removeChild(this.domElements.svg.childNodes[0]);\n        }\n        // this.code.hide();\n        // this.info.unload();\n        return this;\n    }\n\n    public removeObject(obj) {\n        Utils.foreach(this.state.areas, (x, i) => {\n            if (x === obj) {\n                this.state.areas.splice(i, 1);\n            }\n        });\n        obj.remove();\n        this.state.areas.forEach(function (x, i) {\n            switch (x.type) {\n                case 'rectangle':\n                    x._helpers.number.setNumber(i);\n                    break;\n                case 'polygon':\n                    x._helpers[0].setNumber(i);\n                    break;\n                case 'circle':\n                    x._helpers.number.setNumber(i);\n                    break;\n            }\n        })\n        return this;\n    }\n\n    public deselectAll() {\n        Utils.foreach(this.state.areas, function (x) {\n            x.deselect();\n        });\n        return this;\n    }\n\n    public getIsDraw() {\n        return this.state.isDraw;\n    }\n\n    public setIsDraw(arg) {\n        this.state.isDraw = arg;\n        return this;\n    }\n\n    public setMode(arg) {\n        this.onSetMode(arg);\n        this.state.appMode = arg;\n        return this;\n    }\n\n    public getMode() {\n        return this.state.appMode;\n    }\n\n    public onSetMode(mode) {\n\n    }\n\n    public onCurrentType(type) {\n\n    }\n\n    public setShape(arg) {\n        this.state.currentType = arg;\n        this.onCurrentType(arg);\n        return this;\n    }\n\n    public getShape() {\n        return this.state.currentType;\n    }\n\n    public addObject(object) {\n        this.state.areas.push(object);\n        return this;\n    }\n\n    public getNewArea() {\n        return this.state.newArea;\n    }\n\n    public resetNewArea() {\n        this.state.newArea = null;\n        return this;\n    }\n\n    public getSelectedArea() {\n        return this.state.selectedArea;\n    }\n\n    setSelectedArea(obj) {\n        this.state.selectedArea = obj;\n        return this;\n    }\n\n    public getEditType() {\n        return this.state.editType;\n    }\n\n    public setFilename(str) {\n        this.state.image.filename = str;\n        return this;\n    }\n\n    public setEditClass() {\n        this.domElements.container.classList.remove('draw');\n        this.domElements.container.classList.add('edit');\n\n        return this;\n    }\n\n    public setDrawClass() {\n        this.domElements.container.classList.remove('edit');\n        this.domElements.container.classList.add('draw');\n\n        return this;\n    }\n\n    public setDefaultClass() {\n        this.domElements.container.classList.remove('edit');\n        this.domElements.container.classList.remove('draw');\n\n        return this;\n    }\n\n    public addEvent(target, eventType, func) {\n        this.state.events.push(new AppEvent(target, eventType, func));\n        return this;\n    }\n\n    public removeAllEvents() {\n        Utils.foreach(this.state.events, function (x) {\n            x.remove();\n        });\n        this.state.events.length = 0;\n        return this;\n    }\n\n    // public loadJSON(str, width) {\n    //     var obj = JSON.parse(str);\n    //     this.loadImage(obj.img, width);\n    //     return\n    // }\n\n    public getAreas() {\n        return this.state.areas;\n    }\n\n    public getAreasJSON(scale) {\n        if (scale === undefined) {\n            scale = 1;\n        }\n        var obj = {\n            areas: [],\n            img: this.state.image.src\n        };\n        Utils.foreach(this.state.areas, function (x) {\n            var data = x.toJSON();\n            if (data.type != 'polygon') {\n                data.coords.forEach(function (item, i, arr) {\n                    data.coords[i] = (Math.round(item * scale));\n                });\n            }\n            obj.areas.push(data);\n        });\n        return JSON.stringify(obj);\n    }\n\n    public getHTMLCode(arg) {\n        var html_code = '';\n        if (arg) {\n            if (!this.state.areas.length) {\n                return '0 objects';\n            }\n            html_code += Utils.encode('<img src=\"' + this.state.image.filename + '\" alt=\"\" usemap=\"#map\" />') +\n                '<br />' + Utils.encode('<map name=\"map\">') + '<br />';\n            Utils.foreachReverse(this.state.areas, function (x) {\n                html_code += '&nbsp;&nbsp;&nbsp;&nbsp;' + Utils.encode(x.toString()) + '<br />';\n            });\n            html_code += Utils.encode('</map>');\n        } else {\n            Utils.foreachReverse(this.state.areas, function (x) {\n                html_code += x.toString();\n            });\n        }\n        return html_code;\n    }\n}","import {Component, Input, OnInit, Output, OnChanges, SimpleChanges, EventEmitter, forwardRef} from '@angular/core';\nimport {ControlValueAccessor, NG_VALUE_ACCESSOR, NG_VALIDATORS, FormControl} from '@angular/forms';\nimport {EditorApp} from './editor-app.class';\nimport {Utils} from './utils.class';\nimport {Area} from './area.class';\nimport {AreaFactory} from './area-factory.class';\n\n\n@Component({\n    selector: '[ng2-image-map-editor]',\n    template: `<div id=\"wrapper\">\n    <header id=\"header\">\n        <nav id=\"nav\" class=\"clearfix\">\n            <ul class=\"float-left\">\n                <li id=\"to_html\">\n                    <a [class.btn-round-sm-primary]=\"!valid\" class=\"btn-round-sm-default\" href=\"#\" title=\"{{labels.save_answers}}\">\n                        <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\">\n                            <g>\n                                <g>\n                                    <g>\n                                        <path d=\"M305,148c11.046,0,20-8.954,20-20V90c0-11.046-8.954-20-20-20c-11.046,0-20,8.954-20,20v38\n                                                    C285,139.046,293.954,148,305,148z\"/>\n                                        <path d=\"M492,352c11.046,0,20-8.954,20-20V102c0-5.304-2.107-10.392-5.858-14.142l-82-82C420.392,2.107,415.304,0,410,0H80\n                                                    C35.888,0,0,35.888,0,80v352c0,44.112,35.888,80,80,80h352c44.112,0,80-35.888,80-80c0-11.046-8.954-20-20-20\n                                                    c-11.046,0-20,8.954-20,20c0,22.056-17.944,40-40,40V312c0-11.046-8.954-20-20-20H100c-11.046,0-20,8.954-20,20v160\n                                                    c-22.056,0-40-17.944-40-40V80c0-22.056,17.944-40,40-40v118c0,33.084,26.916,60,60,60h201c33.084,0,60-26.916,60-60V40h0.716\n                                                    L472,110.284V332C472,343.046,480.954,352,492,352z M120,332h272v140H120V332z M361,158c0,11.028-8.972,20-20,20H140\n                                                    c-11.028,0-20-8.972-20-20V40h241V158z\"/>\n                                    </g>\n                                </g>\n                            </g>\n                        </svg>\n                    </a>\n                </li>\n                <li><a [class.btn-round-sm-default]=\"currentType != 'rectangle'\" [class.btn-round-sm-primary]=\"currentType == 'rectangle'\" id=\"rectangle\" href=\"#\"><img [src]=\"icons.rectangle\"></a></li>\n                <li><a [class.btn-round-sm-default]=\"currentType != 'circle'\"    [class.btn-round-sm-primary]=\"currentType == 'circle'\" href=\"#\" id=\"circle\"><img [src]=\"icons.circle\"></a></li>\n                <li><a [class.btn-round-sm-default]=\"currentType != 'polygon'\"   [class.btn-round-sm-primary]=\"currentType == 'polygon'\" href=\"#\" id=\"polygon\"><img [src]=\"icons.polygon\"></a></li>\n            </ul>\n            <ul class=\"float-right\">\n                <li class=\"btn\" id=\"edit\">\n                    <a [class.btn-round-sm-default]=\"!isEditMode\" title=\"{{labels.edit}}\" [class.btn-round-sm-primary]=\"isEditMode\" href=\"#\">\n                        <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\">\n                            <g>\n                                <g>\n                                    <path d=\"M481.996,30.006C462.647,10.656,436.922,0,409.559,0c-27.363,0-53.089,10.656-72.438,30.005L50.826,316.301\n                                            c-2.436,2.436-4.201,5.46-5.125,8.779L0.733,486.637c-1.939,6.968,0.034,14.441,5.163,19.542c3.8,3.78,8.892,5.821,14.106,5.821\n                                            c1.822,0,3.66-0.25,5.463-0.762l161.557-45.891c6.816-1.936,12.1-7.335,13.888-14.192c1.788-6.857-0.186-14.148-5.189-19.167\n                                            L93.869,329.827L331.184,92.511l88.258,88.258L237.768,361.948c-7.821,7.8-7.838,20.463-0.038,28.284\n                                            c7.799,7.822,20.464,7.838,28.284,0.039l215.98-215.392C501.344,155.53,512,129.805,512,102.442\n                                            C512,75.079,501.344,49.354,481.996,30.006z M143.395,436.158L48.827,463.02l26.485-95.152L143.395,436.158z M453.73,146.575\n                                            l-5.965,5.949l-88.296-88.297l5.938-5.938C377.2,46.495,392.88,40,409.559,40c16.679,0,32.358,6.495,44.152,18.29\n                                            C465.505,70.083,472,85.763,472,102.442C472,119.121,465.505,134.801,453.73,146.575z\"/>\n                                </g>\n                            </g>\n                        </svg>\n                     </a>\n                </li>\n                <li class=\"btn-round-sm-default\" id=\"clear\">\n                    <a class=\"btn-round-sm-default\" href=\"#\" title=\"{{labels.clear}}\">\n                        <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\">\n                        <g>\n                            <g>\n                                <g>\n                                    <path d=\"M472,83H351V60c0-33.084-26.916-60-60-60h-70c-33.084,0-60,26.916-60,60v23H40c-11.046,0-20,8.954-20,20s8.954,20,20,20\n                                                h20.712l24.374,315.987c0.007,0.092,0.015,0.185,0.023,0.278c1.816,19.924,10.954,38.326,25.73,51.816\n                                                C125.615,504.571,144.771,512,164.778,512h182.444c41.667,0,75.917-31.032,79.669-72.183\n                                                c1.003-11.001-7.101-20.731-18.101-21.734c-11.011-1.003-20.731,7.101-21.734,18.101C385.195,456.603,368.07,472,347.222,472\n                                                H164.778c-20.777,0-37.875-15.571-39.823-36.242L100.831,123h310.338l-17.082,221.462c-0.849,11.013,7.39,20.629,18.403,21.479\n                                                c0.524,0.04,1.043,0.06,1.56,0.06c10.347,0,19.11-7.974,19.919-18.463L451.288,123H472c11.046,0,20-8.954,20-20\n                                                S483.046,83,472,83z M311,83H201V60c0-11.028,8.972-20,20-20h70c11.028,0,20,8.972,20,20V83z\"/>\n                                    <path d=\"M165.127,163.019c-11.035,0.482-19.59,9.818-19.108,20.854l10,228.933c0.469,10.738,9.322,19.128,19.966,19.128\n                                                c0.294,0,0.591-0.006,0.888-0.02c11.035-0.482,19.59-9.818,19.108-20.854l-10-228.934\n                                                C185.499,171.092,176.145,162.523,165.127,163.019z\"/>\n                                    <path d=\"M326.019,182.127l-10,228.934c-0.482,11.035,8.073,20.372,19.108,20.854c0.297,0.013,0.593,0.02,0.888,0.02\n                                                c10.643,0,19.497-8.39,19.966-19.128l10-228.933c0.482-11.035-8.073-20.372-19.108-20.854\n                                                C335.856,162.527,326.501,171.092,326.019,182.127z\"/>\n                                    <path d=\"M236,183v228.933c0,11.046,8.954,20,20,20c11.046,0,20-8.954,20-20V183c0-11.046-8.954-20-20-20S236,171.954,236,183z\"/>\n                                </g>\n                            </g>\n                        </g>\n                    </svg>\n                    </a>\n                </li>\n                <li  id=\"show_help\">\n                    <a class=\"btn-round-sm-default\" href=\"#\">\n                    <svg version=\"1.1\" id=\"Capa_1\" xmlns=\"http://www.w3.org/2000/svg\" x=\"0px\" y=\"0px\"\n                         viewBox=\"0 0 512 512\" style=\"enable-background:new 0 0 512 512;\"\n                         xml:space=\"preserve\">\n                        <g>\n                            <g>\n                                <g>\n                                    <circle cx=\"256\" cy=\"127\" r=\"20\"/>\n                                    <path d=\"M437.02,74.98C388.667,26.629,324.38,0,256,0S123.333,26.629,74.98,74.98C26.629,123.333,0,187.62,0,256\n                                    s26.629,132.667,74.98,181.02C123.333,485.371,187.62,512,256,512c46.813,0,92.618-12.758,132.461-36.893\n                                    c9.448-5.724,12.467-18.022,6.744-27.469c-5.723-9.448-18.021-12.467-27.468-6.744C334.144,461.244,295.506,472,256,472\n                                    c-119.103,0-216-96.897-216-216S136.897,40,256,40s216,96.897,216,216c0,42.589-12.665,84.044-36.627,119.884\n                                    c-6.139,9.182-3.672,21.603,5.511,27.742c9.183,6.138,21.603,3.673,27.742-5.51C497.001,355.674,512,306.53,512,256\n                                    C512,187.62,485.371,123.333,437.02,74.98z\"/>\n                                    <path d=\"M256,187c-11.046,0-20,8.954-20,20v178c0,11.046,8.954,20,20,20s20-8.954,20-20V207C276,195.954,267.046,187,256,187z\"/>\n                                </g>\n                            </g>\n                        </g>\n                    </svg>\n                </a>\n                </li>\n            </ul>\n        </nav>\n        <div id=\"coords\"></div>\n        <div id=\"debug\"></div>\n    </header>\n    <div id=\"image_wrapper\">\n        <div id=\"image\">\n            <img src=\"\" alt=\"#\" id=\"img\" />\n            <svg xmlns=\"http://www.w3.org/2000/svg\" version=\"1.2\" baseProfile=\"tiny\" id=\"svg\"></svg>\n        </div>\n    </div>\n</div>\n\n        <!-- From html block -->\n        <div id=\"from_html_wrapper\">\n            <form id=\"from_html_form\">\n                <h5>Loading areas</h5>\n                <span class=\"close_button\" title=\"close\"></span>\n                <p>\n                    <label for=\"code_input\">Enter your html code:</label>\n                    <textarea id=\"code_input\"></textarea>\n                </p>\n                <button id=\"load_code_button\">Load</button>\n            </form>\n        </div>\n        <!-- Get image form -->\n\n        <!-- Help block    {{''|translate}} -->\n        <div id=\"overlay\"></div>\n        <div id=\"help\">\n            <span class=\"close_button\" title=\"close\"></span>\n            <div class=\"txt\">\n                <section>\n                    <h2>{{labels.drawing_mode}}</h2>\n                    <p><span class=\"key\">ENTER</span> &mdash; {{labels.drawing_mode_enter}}</p>\n                    <p><span class=\"key\">ESC</span> &mdash; {{labels.drawing_mode_esc}}</p>\n                    <p><span class=\"key\">SHIFT</span> &mdash; {{labels.drawing_mode_shift}}</p>\n                </section>\n                <section>\n                    <h2>{{labels.editing_mode}}</h2>\n                    <p><span class=\"key\">DELETE</span> &mdash; {{labels.editing_mode_delete}}</p>\n                    <p><span class=\"key\">ESC</span> &mdash; {{labels.editing_mode_esc}}</p>\n                    <p><span class=\"key\">SHIFT</span> &mdash; {{labels.editing_mode_shift}}</p>\n                    <p><span class=\"key\">&uarr;</span> &mdash; {{labels.editing_mode_up}}</p>\n                    <p><span class=\"key\">&darr;</span> &mdash; {{labels.editing_mode_down}}</p>\n                    <p><span class=\"key\">&larr;</span> &mdash; {{labels.editing_mode_left}}</p>\n                    <p><span class=\"key\">&rarr;</span> &mdash; {{labels.editing_mode_right}}</p>\n                </section>\n            </div>\n        </div>`,\n    providers: [\n        {\n            provide: NG_VALUE_ACCESSOR,\n            useExisting: forwardRef(() => Ng2ImageMapEditorDirective),\n            multi: true\n        },\n        {\n            provide: NG_VALIDATORS,\n            useExisting: forwardRef(() => Ng2ImageMapEditorDirective),\n            multi: true\n        }\n    ]\n})\nexport class Ng2ImageMapEditorDirective implements ControlValueAccessor, OnChanges, OnInit {\n    @Input('answers') answers: any[] = [];\n    @Input('src') mainImageSrc: string;\n    @Input('width') mainImageWidth: number;\n\n    public valid: boolean = true;\n    public isEditMode: boolean = false;\n    public currentType: string = '';\n\n    public icons: any = {\n        rectangle: '/src/assets/img/test/rec.svg',\n        circle: '/src/assets/img/test/cir.svg',\n        polygon: '/src/assets/img/test/pol.svg'\n    };\n\n    public labels: any = {};\n\n    public static globalLabels: any = {\n        save_answers: 'Save answers',\n        edit: 'Edit',\n        clear: 'Clear',\n        drawing_mode: 'Drawing mode (rectangle / circle / polygon)',\n        drawing_mode_enter: 'stop polygon drawing (or click on first helper)',\n        drawing_mode_esc: 'cancel drawing of a new area',\n        drawing_mode_shift: 'square drawing in case of a rectangle and right angle drawing in case of a polygon',\n        editing_mode: 'Editing mode',\n        editing_mode_delete: 'remove a selected area',\n        editing_mode_esc: 'cancel editing of a selected area',\n        editing_mode_shift: 'edit and save proportions for rectangle',\n        editing_mode_up: 'move a selected area up',\n        editing_mode_down: 'move a selected area down',\n        editing_mode_left: 'move a selected area to the left',\n        editing_mode_right: 'move a selected area to the right'\n    };\n\n    public app: EditorApp;\n\n    public _value: string;\n    private _parsedValue: any;\n\n    private _loadedImage: string = '';\n\n    @Output() onAnswersUpdated = new EventEmitter();\n\n    constructor() {\n    }\n\n    validate(c: FormControl) {\n        if (this.valid) {\n            return null;\n        }\n        return {\n            required: true\n        };\n    }\n\n    propagateChange = (_: any) => {\n    };\n\n    registerOnChange(fn) {\n        this.propagateChange = fn;\n    }\n\n    registerOnTouched() {\n        // console.log('registerOnTouched');\n    }\n\n    writeValue(value: string) {\n        this._value = value;\n\n        if (this._value) {\n            this._parsedValue = JSON.parse(this._value);\n        }\n        if (this._value && this.mainImageWidth && this.app) {\n            if(this._loadedImage != this._parsedValue.img) {\n                this._loadedImage = this._parsedValue.img;\n                this.app.loadImage(this._parsedValue.img, this.mainImageWidth);\n                // console.log('writeValue loadImage', this._parsedValue.img, this.mainImageWidth);\n            }\n        }\n    }\n\n    public ngOnInit() {\n        this.labels = Ng2ImageMapEditorDirective.globalLabels;\n        this.app = new EditorApp();\n        Utils.app = this.app;\n        Area.app = this.app;\n\n        this.app.buttons.onSetInvalid = () => {\n            this.valid = false;\n            this.propagateChange([]);\n        };\n        this.app.buttons.onData = (answers: any[], areas: any) => {\n            this.valid = true;\n            this.propagateChange(areas);\n            this.answers = answers;\n            this.onAnswersUpdated.emit(answers);\n        };\n        this.app.onCurrentType = (type: string) => {\n            this.currentType = type;\n        };\n        this.app.onSetMode = (mode: string) => {\n            this.isEditMode = mode == 'editing';\n        };\n        this.app.onImageLoaded = (state: any) => {\n            // console.log('onImageLoaded');\n\n            if (this._value) {\n                var scale = 1;\n                if (state.image.width > this.app.domElements.img.clientWidth) {\n                    scale = Number((state.image.width / this.app.domElements.img.clientWidth).toFixed(3));\n                } else {\n                    scale = 1;\n                }\n                // console.log('onImageLoaded', this._parsedValue, this.app.img.width, this.app.domElements.img.clientWidth);\n                // console.log('scale', scale );\n\n                // console.log('this.answers', this.answers);\n\n                Utils.foreach(this._parsedValue.areas, (x, i, arr) => {\n                    if (x.type in AreaFactory.CONSTRUCTORS) {\n                        //adaptation coordinates in screen resolution\n                        x.coords.forEach((item, i, arr) => {\n                            x.coords[i] = Math.round(item / scale);\n                        });\n\n                        AreaFactory.CONSTRUCTORS[x.type].createFromSaved({\n                            coords: x.coords,\n                            href: x.href,\n                            alt: (this.answers[i] != undefined && this.answers[i].is_right) ? '1' : '0',//x.alt,\n                            title: (this.answers[i] != undefined) ? this.answers[i].body : x.title,\n                            number: i\n                        });\n                    }\n                });\n            }\n        };\n\n        if (this.mainImageSrc && this.mainImageWidth && this._loadedImage != this.mainImageSrc) {\n            this._loadedImage = this.mainImageSrc;\n            this.app.loadImage(this.mainImageSrc, this.mainImageWidth);\n            // console.log('ngOnInit loadImage', this.mainImageSrc, this.mainImageWidth);\n        }\n    }\n\n    public ngOnChanges(changes: SimpleChanges) {\n        if (this.mainImageSrc && this.mainImageWidth && this.app && this._loadedImage != this.mainImageSrc) {\n            this._loadedImage = this.mainImageSrc;\n            this.app.loadImage(this.mainImageSrc, this.mainImageWidth);\n            // console.log('ngOnChanges loadImage', this.mainImageSrc, this.mainImageWidth);\n        }\n    }\n}\n","import {NgModule} from '@angular/core';\nimport {Ng2ImageMapEditorDirective} from './ng2-image-map-editor.directive';\n\n@NgModule({\n    imports: [],\n    declarations: [\n        Ng2ImageMapEditorDirective\n    ],\n    exports: [\n        Ng2ImageMapEditorDirective\n    ]\n})\nexport class Ng2ImageMapEditorModule {\n}\n"]}