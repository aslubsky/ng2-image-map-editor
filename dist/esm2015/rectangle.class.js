import { Area } from './area.class';
import { Helper } from './helper.class';
import { Utils } from './utils.class';
/**
 * The constructor for rectangles
 *
 * Initial state:
 * (x, y) -----
 * |          |
 * -----------
 * with width = 0 and height = 0
 *
 * @constructor
 * @param coords {Object} - coordinates of the begin point, e.g. {x: 100, y: 200}
 */
export class Rectangle extends Area {
    constructor(coords, type) {
        super(coords, 'rectangle');
        /**
         * @namespace
         * @property {number} x - Distance from the left edge of the image to the left side of the rectangle
         * @property {number} y - Distance from the top edge of the image to the top side of the rectangle
         * @property {number} width - Width of rectangle
         * @property {number} height - Height of rectangle
         */
        this._params = {
            x: coords.x,
            y: coords.y,
            width: 0,
            height: 0
        };
        this._el = document.createElementNS(Area.SVG_NS, 'rect');
        this._groupEl.appendChild(this._el);
        var x = coords.x - this._params.width / 2, y = coords.y - this._params.height / 2;
        this._helpers = {
            number: new Helper(this._groupEl, x, y, 'number'),
            center: new Helper(this._groupEl, x, y, 'move'),
            top: new Helper(this._groupEl, x, y, 'editTop'),
            bottom: new Helper(this._groupEl, x, y, 'editBottom'),
            left: new Helper(this._groupEl, x, y, 'editLeft'),
            right: new Helper(this._groupEl, x, y, 'editRight'),
            topLeft: new Helper(this._groupEl, x, y, 'editTopLeft'),
            topRight: new Helper(this._groupEl, x, y, 'editTopRight'),
            bottomLeft: new Helper(this._groupEl, x, y, 'editBottomLeft'),
            bottomRight: new Helper(this._groupEl, x, y, 'editBottomRight')
        };
        this._helpers.number.setNumber(coords.n);
        this.select().redraw();
        /* Add this object to array of all objects */
        Area.app.addObject(this);
    }
    /**
     * Set attributes for svg-elements of area by new parameters
     * -----top-----
     * |           |
     * ---center_y--
     * |           |
     * ---bottom----
     */
    setSVGAttributes(params) {
        this._el.setAttribute('x', params.x);
        this._el.setAttribute('y', params.y);
        this._el.setAttribute('width', params.width);
        this._el.setAttribute('height', params.height);
        var top = params.y, center_y = params.y + params.height / 2, bottom = params.y + params.height, left = params.x, center_x = params.x + params.width / 2, right = params.x + params.width;
        this._helpers.number.setCoords(left, top - 5);
        this._helpers.center.setCoords(center_x, center_y);
        this._helpers.top.setCoords(center_x, top);
        this._helpers.bottom.setCoords(center_x, bottom);
        this._helpers.left.setCoords(left, center_y);
        this._helpers.right.setCoords(right, center_y);
        this._helpers.topLeft.setCoords(left, top);
        this._helpers.topRight.setCoords(right, top);
        this._helpers.bottomLeft.setCoords(left, bottom);
        this._helpers.bottomRight.setCoords(right, bottom);
        return this;
    }
    redraw(params) {
        this.setSVGAttributes(params ? params : this._params);
        return this;
    }
    setParams(params) {
        this._params.x = params.x;
        this._params.y = params.y;
        this._params.width = params.width;
        this._params.height = params.height;
        return this;
    }
    getNormalizedCoords() {
    }
    dynamicDraw(x1, y1, isSquare) {
        var x0 = this._params.x, y0 = this._params.y, new_x, new_y, new_width, new_height, delta, temp_params;
        new_width = Math.abs(x1 - x0);
        new_height = Math.abs(y1 - y0);
        if (isSquare) {
            delta = new_width - new_height;
            if (delta > 0) {
                new_width = new_height;
            }
            else {
                new_height = new_width;
            }
        }
        if (x0 > x1) {
            new_x = x1;
            if (isSquare && delta > 0) {
                new_x = x1 + Math.abs(delta);
            }
        }
        else {
            new_x = x0;
        }
        if (y0 > y1) {
            new_y = y1;
            if (isSquare && delta < 0) {
                new_y = y1 + Math.abs(delta);
            }
        }
        else {
            new_y = y0;
        }
        temp_params = {
            x: new_x,
            y: new_y,
            width: new_width,
            height: new_height
        };
        this.setSVGAttributes(temp_params);
        return temp_params;
    }
    onProcessDrawing(e) {
        var coords = Utils.getRightCoords(e.pageX, e.pageY);
        this.dynamicDraw(coords.x, coords.y, e.shiftKey);
    }
    onStopDrawing(e) {
        var coords = Utils.getRightCoords(e.pageX, e.pageY);
        this.setParams(this.dynamicDraw(coords.x, coords.y, e.shiftKey)).deselect();
        Area.app.removeAllEvents()
            .setIsDraw(false)
            .resetNewArea();
    }
    move(dx, dy) {
        var temp_params = Object.create(this._params);
        temp_params.x += dx;
        temp_params.y += dy;
        return temp_params;
    }
    /**
     * Changes area parameters by editing type and offsets
     *
     * @param {String} editingType - A type of editing
     * @returns {Object} - Object with changed parameters of area
     */
    edit(editingType, dx, dy) {
        var tempParams = Object.assign({}, this._params);
        switch (editingType) {
            case 'move':
                tempParams.x += dx;
                tempParams.y += dy;
                break;
            case 'editLeft':
                tempParams.x += dx;
                tempParams.width -= dx;
                break;
            case 'editRight':
                tempParams.width += dx;
                break;
            case 'editTop':
                tempParams.y += dy;
                tempParams.height -= dy;
                break;
            case 'editBottom':
                tempParams.height += dy;
                break;
            case 'editTopLeft':
                tempParams.x += dx;
                tempParams.y += dy;
                tempParams.width -= dx;
                tempParams.height -= dy;
                break;
            case 'editTopRight':
                tempParams.y += dy;
                tempParams.width += dx;
                tempParams.height -= dy;
                break;
            case 'editBottomLeft':
                tempParams.x += dx;
                tempParams.width -= dx;
                tempParams.height += dy;
                break;
            case 'editBottomRight':
                tempParams.width += dx;
                tempParams.height += dy;
                break;
        }
        return tempParams;
    }
    dynamicEdit(temp_params, saveProportions) {
        if (temp_params.width < 0) {
            temp_params.width = Math.abs(temp_params.width);
            temp_params.x -= temp_params.width;
        }
        if (temp_params.height < 0) {
            temp_params.height = Math.abs(temp_params.height);
            temp_params.y -= temp_params.height;
        }
        if (saveProportions) {
            var proportions = this._params.width / this._params.height, new_proportions = temp_params.width / temp_params.height, delta = new_proportions - proportions, x0 = this._params.x, y0 = this._params.y, x1 = temp_params.x, y1 = temp_params.y;
            if (delta > 0) {
                temp_params.width = Math.round(temp_params.height * proportions);
            }
            else {
                temp_params.height = Math.round(temp_params.width / proportions);
            }
        }
        this.setSVGAttributes(temp_params);
        return temp_params;
    }
    onProcessEditing(e) {
        return this.dynamicEdit(this.edit(Area.app.getEditType(), e.pageX - this.delta.x, e.pageY - this.delta.y), e.shiftKey);
    }
    onStopEditing(e) {
        this.setParams(this.onProcessEditing(e));
        Area.app.removeAllEvents()
            .setIsDraw(false)
            .resetNewArea();
    }
    toString() {
        var x2 = this._params.x + this._params.width, y2 = this._params.y + this._params.height;
        return '<area shape="rect" coords="' // TODO: use template engine
            + this._params.x + ', '
            + this._params.y + ', '
            + x2 + ', '
            + y2
            + '"'
            + (this.href ? ' href="' + this.href + '"' : '')
            + (this.alt ? ' alt="' + this.alt + '"' : '')
            + (this.title ? ' title="' + this.title + '"' : '')
            + ' />';
    }
    toJSON() {
        return {
            type: 'rectangle',
            coords: [
                this._params.x,
                this._params.y,
                this._params.x + this._params.width,
                this._params.y + this._params.height
            ],
            href: this.attributes.href,
            alt: this.attributes.alt,
            title: this.attributes.title
        };
    }
    /**
     * Returns true if coords array is valid for rectangles and false otherwise
     *
     * @static
     * @param coords {Array} - coords for new rectangle as array
     * @return {boolean}
     */
    static testCoords(coords) {
        return coords.length === 4;
    }
    static createFromSaved(params) {
        if (!this.testCoords(params.coords)) {
            return;
        }
        Area.app.setIsDraw(true);
        var area = new Rectangle({
            x: params.coords[0],
            y: params.coords[1],
            n: params.number
        });
        area.setParams(area.dynamicDraw(params.coords[2], params.coords[3])).deselect();
        Area.app.setIsDraw(false)
            .resetNewArea();
        area.setInfoAttributes(params);
    }
    /**
     * Creates new rectangle and add drawing handlers for DOM-elements
     *
     * @param coords {Object} coords
     * @returns created rectangle
     */
    static createAndStartDrawing(coords) {
        coords.n = Area.app.getAreas().length;
        var newArea = new Rectangle(coords);
        Area.app.addEvent(Area.app.domElements.container, 'mousemove', newArea.onProcessDrawing.bind(newArea))
            .addEvent(Area.app.domElements.container, 'click', newArea.onStopDrawing.bind(newArea));
        return newArea;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVjdGFuZ2xlLmNsYXNzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3JlY3RhbmdsZS5jbGFzcy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUMsSUFBSSxFQUFDLE1BQU0sY0FBYyxDQUFDO0FBQ2xDLE9BQU8sRUFBQyxNQUFNLEVBQUMsTUFBTSxnQkFBZ0IsQ0FBQztBQUN0QyxPQUFPLEVBQUMsS0FBSyxFQUFDLE1BQU0sZUFBZSxDQUFDO0FBRXBDOzs7Ozs7Ozs7OztHQVdHO0FBQ0gsTUFBTSxPQUFPLFNBQVUsU0FBUSxJQUFJO0lBRy9CLFlBQVksTUFBVyxFQUFFLElBQVU7UUFDL0IsS0FBSyxDQUFDLE1BQU0sRUFBRSxXQUFXLENBQUMsQ0FBQztRQUUzQjs7Ozs7O1dBTUc7UUFDSCxJQUFJLENBQUMsT0FBTyxHQUFHO1lBQ1gsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDO1lBQ1gsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDO1lBQ1gsS0FBSyxFQUFFLENBQUM7WUFDUixNQUFNLEVBQUUsQ0FBQztTQUNaLENBQUM7UUFFRixJQUFJLENBQUMsR0FBRyxHQUFHLFFBQVEsQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxNQUFNLENBQUMsQ0FBQztRQUN6RCxJQUFJLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7UUFFcEMsSUFBSSxDQUFDLEdBQUcsTUFBTSxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssR0FBRyxDQUFDLEVBQ3JDLENBQUMsR0FBRyxNQUFNLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQztRQUUzQyxJQUFJLENBQUMsUUFBUSxHQUFHO1lBQ1osTUFBTSxFQUFFLElBQUksTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQyxFQUFFLENBQUMs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QU8sR0FBRyxJQUFJLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUVwQyxJQUFJLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLFdBQVcsQ0FBQyxTQUFTLEVBQUUsV0FBVyxFQUFFLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7YUFDakcsUUFBUSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsV0FBVyxDQUFDLFNBQVMsRUFBRSxPQUFPLEVBQUUsT0FBTyxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztRQUU1RixPQUFPLE9BQU8sQ0FBQztJQUNuQixDQUFDO0NBQ0oiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0FyZWF9IGZyb20gJy4vYXJlYS5jbGFzcyc7XG5pbXBvcnQge0hlbHBlcn0gZnJvbSAnLi9oZWxwZXIuY2xhc3MnO1xuaW1wb3J0IHtVdGlsc30gZnJvbSAnLi91dGlscy5jbGFzcyc7XG5cbi8qKlxuICogVGhlIGNvbnN0cnVjdG9yIGZvciByZWN0YW5nbGVzXG4gKlxuICogSW5pdGlhbCBzdGF0ZTpcbiAqICh4LCB5KSAtLS0tLVxuICogfCAgICAgICAgICB8XG4gKiAtLS0tLS0tLS0tLVxuICogd2l0aCB3aWR0aCA9IDAgYW5kIGhlaWdodCA9IDBcbiAqXG4gKiBAY29uc3RydWN0b3JcbiAqIEBwYXJhbSBjb29yZHMge09iamVjdH0gLSBjb29yZGluYXRlcyBvZiB0aGUgYmVnaW4gcG9pbnQsIGUuZy4ge3g6IDEwMCwgeTogMjAwfVxuICovXG5leHBvcnQgY2xhc3MgUmVjdGFuZ2xlIGV4dGVuZHMgQXJlYSB7XG4gICAgcHVibGljIGF0dHJpYnV0ZXM6IGFueTtcblxuICAgIGNvbnN0cnVjdG9yKGNvb3JkczogYW55LCB0eXBlPzogYW55KSB7XG4gICAgICAgIHN1cGVyKGNvb3JkcywgJ3JlY3RhbmdsZScpO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbmFtZXNwYWNlXG4gICAgICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSB4IC0gRGlzdGFuY2UgZnJvbSB0aGUgbGVmdCBlZGdlIG9mIHRoZSBpbWFnZSB0byB0aGUgbGVmdCBzaWRlIG9mIHRoZSByZWN0YW5nbGVcbiAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ9IHkgLSBEaXN0YW5jZSBmcm9tIHRoZSB0b3AgZWRnZSBvZiB0aGUgaW1hZ2UgdG8gdGhlIHRvcCBzaWRlIG9mIHRoZSByZWN0YW5nbGVcbiAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ9IHdpZHRoIC0gV2lkdGggb2YgcmVjdGFuZ2xlXG4gICAgICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBoZWlnaHQgLSBIZWlnaHQgb2YgcmVjdGFuZ2xlXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLl9wYXJhbXMgPSB7XG4gICAgICAgICAgICB4OiBjb29yZHMueCxcbiAgICAgICAgICAgIHk6IGNvb3Jkcy55LFxuICAgICAgICAgICAgd2lkdGg6IDAsXG4gICAgICAgICAgICBoZWlnaHQ6IDBcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLl9lbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhBcmVhLlNWR19OUywgJ3JlY3QnKTtcbiAgICAgICAgdGhpcy5fZ3JvdXBFbC5hcHBlbmRDaGlsZCh0aGlzLl9lbCk7XG5cbiAgICAgICAgdmFyIHggPSBjb29yZHMueCAtIHRoaXMuX3BhcmFtcy53aWR0aCAvIDIsXG4gICAgICAgICAgICB5ID0gY29vcmRzLnkgLSB0aGlzLl9wYXJhbXMuaGVpZ2h0IC8gMjtcblxuICAgICAgICB0aGlzLl9oZWxwZXJzID0ge1xuICAgICAgICAgICAgbnVtYmVyOiBuZXcgSGVscGVyKHRoaXMuX2dyb3VwRWwsIHgsIHksICdudW1iZXInKSxcbiAgICAgICAgICAgIGNlbnRlcjogbmV3IEhlbHBlcih0aGlzLl9ncm91cEVsLCB4LCB5LCAnbW92ZScpLFxuICAgICAgICAgICAgdG9wOiBuZXcgSGVscGVyKHRoaXMuX2dyb3VwRWwsIHgsIHksICdlZGl0VG9wJyksXG4gICAgICAgICAgICBib3R0b206IG5ldyBIZWxwZXIodGhpcy5fZ3JvdXBFbCwgeCwgeSwgJ2VkaXRCb3R0b20nKSxcbiAgICAgICAgICAgIGxlZnQ6IG5ldyBIZWxwZXIodGhpcy5fZ3JvdXBFbCwgeCwgeSwgJ2VkaXRMZWZ0JyksXG4gICAgICAgICAgICByaWdodDogbmV3IEhlbHBlcih0aGlzLl9ncm91cEVsLCB4LCB5LCAnZWRpdFJpZ2h0JyksXG4gICAgICAgICAgICB0b3BMZWZ0OiBuZXcgSGVscGVyKHRoaXMuX2dyb3VwRWwsIHgsIHksICdlZGl0VG9wTGVmdCcpLFxuICAgICAgICAgICAgdG9wUmlnaHQ6IG5ldyBIZWxwZXIodGhpcy5fZ3JvdXBFbCwgeCwgeSwgJ2VkaXRUb3BSaWdodCcpLFxuICAgICAgICAgICAgYm90dG9tTGVmdDogbmV3IEhlbHBlcih0aGlzLl9ncm91cEVsLCB4LCB5LCAnZWRpdEJvdHRvbUxlZnQnKSxcbiAgICAgICAgICAgIGJvdHRvbVJpZ2h0OiBuZXcgSGVscGVyKHRoaXMuX2dyb3VwRWwsIHgsIHksICdlZGl0Qm90dG9tUmlnaHQnKVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLl9oZWxwZXJzLm51bWJlci5zZXROdW1iZXIoY29vcmRzLm4pO1xuICAgICAgICB0aGlzLnNlbGVjdCgpLnJlZHJhdygpO1xuXG4gICAgICAgIC8qIEFkZCB0aGlzIG9iamVjdCB0byBhcnJheSBvZiBhbGwgb2JqZWN0cyAqL1xuICAgICAgICBBcmVhLmFwcC5hZGRPYmplY3QodGhpcyk7XG4gICAgfVxuXG5cbiAgICAvKipcbiAgICAgKiBTZXQgYXR0cmlidXRlcyBmb3Igc3ZnLWVsZW1lbnRzIG9mIGFyZWEgYnkgbmV3IHBhcmFtZXRlcnNcbiAgICAgKiAtLS0tLXRvcC0tLS0tXG4gICAgICogfCAgICAgICAgICAgfFxuICAgICAqIC0tLWNlbnRlcl95LS1cbiAgICAgKiB8ICAgICAgICAgICB8XG4gICAgICogLS0tYm90dG9tLS0tLVxuICAgICAqL1xuICAgIHB1YmxpYyBzZXRTVkdBdHRyaWJ1dGVzKHBhcmFtczogYW55KSB7XG4gICAgICAgIHRoaXMuX2VsLnNldEF0dHJpYnV0ZSgneCcsIHBhcmFtcy54KTtcbiAgICAgICAgdGhpcy5fZWwuc2V0QXR0cmlidXRlKCd5JywgcGFyYW1zLnkpO1xuICAgICAgICB0aGlzLl9lbC5zZXRBdHRyaWJ1dGUoJ3dpZHRoJywgcGFyYW1zLndpZHRoKTtcbiAgICAgICAgdGhpcy5fZWwuc2V0QXR0cmlidXRlKCdoZWlnaHQnLCBwYXJhbXMuaGVpZ2h0KTtcblxuICAgICAgICB2YXIgdG9wID0gcGFyYW1zLnksXG4gICAgICAgICAgICBjZW50ZXJfeSA9IHBhcmFtcy55ICsgcGFyYW1zLmhlaWdodCAvIDIsXG4gICAgICAgICAgICBib3R0b20gPSBwYXJhbXMueSArIHBhcmFtcy5oZWlnaHQsXG4gICAgICAgICAgICBsZWZ0ID0gcGFyYW1zLngsXG4gICAgICAgICAgICBjZW50ZXJfeCA9IHBhcmFtcy54ICsgcGFyYW1zLndpZHRoIC8gMixcbiAgICAgICAgICAgIHJpZ2h0ID0gcGFyYW1zLnggKyBwYXJhbXMud2lkdGg7XG5cbiAgICAgICAgdGhpcy5faGVscGVycy5udW1iZXIuc2V0Q29vcmRzKGxlZnQsIHRvcCAtIDUpO1xuICAgICAgICB0aGlzLl9oZWxwZXJzLmNlbnRlci5zZXRDb29yZHMoY2VudGVyX3gsIGNlbnRlcl95KTtcbiAgICAgICAgdGhpcy5faGVscGVycy50b3Auc2V0Q29vcmRzKGNlbnRlcl94LCB0b3ApO1xuICAgICAgICB0aGlzLl9oZWxwZXJzLmJvdHRvbS5zZXRDb29yZHMoY2VudGVyX3gsIGJvdHRvbSk7XG4gICAgICAgIHRoaXMuX2hlbHBlcnMubGVmdC5zZXRDb29yZHMobGVmdCwgY2VudGVyX3kpO1xuICAgICAgICB0aGlzLl9oZWxwZXJzLnJpZ2h0LnNldENvb3JkcyhyaWdodCwgY2VudGVyX3kpO1xuICAgICAgICB0aGlzLl9oZWxwZXJzLnRvcExlZnQuc2V0Q29vcmRzKGxlZnQsIHRvcCk7XG4gICAgICAgIHRoaXMuX2hlbHBlcnMudG9wUmlnaHQuc2V0Q29vcmRzKHJpZ2h0LCB0b3ApO1xuICAgICAgICB0aGlzLl9oZWxwZXJzLmJvdHRvbUxlZnQuc2V0Q29vcmRzKGxlZnQsIGJvdHRvbSk7XG4gICAgICAgIHRoaXMuX2hlbHBlcnMuYm90dG9tUmlnaHQuc2V0Q29vcmRzKHJpZ2h0LCBib3R0b20pO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICBwdWJsaWMgcmVkcmF3KHBhcmFtcz86IGFueSkge1xuICAgICAgICB0aGlzLnNldFNWR0F0dHJpYnV0ZXMocGFyYW1zID8gcGFyYW1zIDogdGhpcy5fcGFyYW1zKTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgcHVibGljIHNldFBhcmFtcyhwYXJhbXM6IGFueSkge1xuICAgICAgICB0aGlzLl9wYXJhbXMueCA9IHBhcmFtcy54O1xuICAgICAgICB0aGlzLl9wYXJhbXMueSA9IHBhcmFtcy55O1xuICAgICAgICB0aGlzLl9wYXJhbXMud2lkdGggPSBwYXJhbXMud2lkdGg7XG4gICAgICAgIHRoaXMuX3BhcmFtcy5oZWlnaHQgPSBwYXJhbXMuaGVpZ2h0O1xuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXROb3JtYWxpemVkQ29vcmRzKCkge1xuXG4gICAgfVxuXG4gICAgcHVibGljIGR5bmFtaWNEcmF3KHgxOiBudW1iZXIsIHkxOiBudW1iZXIsIGlzU3F1YXJlPzogYm9vbGVhbikge1xuICAgICAgICB2YXIgeDAgPSB0aGlzLl9wYXJhbXMueCxcbiAgICAgICAgICAgIHkwID0gdGhpcy5fcGFyYW1zLnksXG4gICAgICAgICAgICBuZXdfeCxcbiAgICAgICAgICAgIG5ld195LFxuICAgICAgICAgICAgbmV3X3dpZHRoLFxuICAgICAgICAgICAgbmV3X2hlaWdodCxcbiAgICAgICAgICAgIGRlbHRhLFxuICAgICAgICAgICAgdGVtcF9wYXJhbXM7XG5cbiAgICAgICAgbmV3X3dpZHRoID0gTWF0aC5hYnMoeDEgLSB4MCk7XG4gICAgICAgIG5ld19oZWlnaHQgPSBNYXRoLmFicyh5MSAtIHkwKTtcblxuICAgICAgICBpZiAoaXNTcXVhcmUpIHtcbiAgICAgICAgICAgIGRlbHRhID0gbmV3X3dpZHRoIC0gbmV3X2hlaWdodDtcbiAgICAgICAgICAgIGlmIChkZWx0YSA+IDApIHtcbiAgICAgICAgICAgICAgICBuZXdfd2lkdGggPSBuZXdfaGVpZ2h0O1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBuZXdfaGVpZ2h0ID0gbmV3X3dpZHRoO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHgwID4geDEpIHtcbiAgICAgICAgICAgIG5ld194ID0geDE7XG4gICAgICAgICAgICBpZiAoaXNTcXVhcmUgJiYgZGVsdGEgPiAwKSB7XG4gICAgICAgICAgICAgICAgbmV3X3ggPSB4MSArIE1hdGguYWJzKGRlbHRhKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG5ld194ID0geDA7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoeTAgPiB5MSkge1xuICAgICAgICAgICAgbmV3X3kgPSB5MTtcbiAgICAgICAgICAgIGlmIChpc1NxdWFyZSAmJiBkZWx0YSA8IDApIHtcbiAgICAgICAgICAgICAgICBuZXdfeSA9IHkxICsgTWF0aC5hYnMoZGVsdGEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbmV3X3kgPSB5MDtcbiAgICAgICAgfVxuXG4gICAgICAgIHRlbXBfcGFyYW1zID0ge1xuICAgICAgICAgICAgeDogbmV3X3gsXG4gICAgICAgICAgICB5OiBuZXdfeSxcbiAgICAgICAgICAgIHdpZHRoOiBuZXdfd2lkdGgsXG4gICAgICAgICAgICBoZWlnaHQ6IG5ld19oZWlnaHRcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLnNldFNWR0F0dHJpYnV0ZXModGVtcF9wYXJhbXMpO1xuXG4gICAgICAgIHJldHVybiB0ZW1wX3BhcmFtcztcbiAgICB9XG5cblxuICAgIHB1YmxpYyBvblByb2Nlc3NEcmF3aW5nKGU6IGFueSkge1xuICAgICAgICB2YXIgY29vcmRzID0gVXRpbHMuZ2V0UmlnaHRDb29yZHMoZS5wYWdlWCwgZS5wYWdlWSk7XG5cbiAgICAgICAgdGhpcy5keW5hbWljRHJhdyhjb29yZHMueCwgY29vcmRzLnksIGUuc2hpZnRLZXkpO1xuICAgIH1cblxuICAgIHB1YmxpYyBvblN0b3BEcmF3aW5nKGU6IGFueSkge1xuICAgICAgICB2YXIgY29vcmRzID0gVXRpbHMuZ2V0UmlnaHRDb29yZHMoZS5wYWdlWCwgZS5wYWdlWSk7XG5cbiAgICAgICAgdGhpcy5zZXRQYXJhbXModGhpcy5keW5hbWljRHJhdyhjb29yZHMueCwgY29vcmRzLnksIGUuc2hpZnRLZXkpKS5kZXNlbGVjdCgpO1xuXG4gICAgICAgIEFyZWEuYXBwLnJlbW92ZUFsbEV2ZW50cygpXG4gICAgICAgICAgICAuc2V0SXNEcmF3KGZhbHNlKVxuICAgICAgICAgICAgLnJlc2V0TmV3QXJlYSgpO1xuICAgIH1cblxuICAgIHB1YmxpYyBtb3ZlKGR4OiBudW1iZXIsIGR5OiBudW1iZXIpIHsgLy9vZmZzZXQgeCBhbmQgeVxuICAgICAgICB2YXIgdGVtcF9wYXJhbXMgPSBPYmplY3QuY3JlYXRlKHRoaXMuX3BhcmFtcyk7XG5cbiAgICAgICAgdGVtcF9wYXJhbXMueCArPSBkeDtcbiAgICAgICAgdGVtcF9wYXJhbXMueSArPSBkeTtcblxuICAgICAgICByZXR1cm4gdGVtcF9wYXJhbXM7XG4gICAgfVxuXG5cbiAgICAvKipcbiAgICAgKiBDaGFuZ2VzIGFyZWEgcGFyYW1ldGVycyBieSBlZGl0aW5nIHR5cGUgYW5kIG9mZnNldHNcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBlZGl0aW5nVHlwZSAtIEEgdHlwZSBvZiBlZGl0aW5nXG4gICAgICogQHJldHVybnMge09iamVjdH0gLSBPYmplY3Qgd2l0aCBjaGFuZ2VkIHBhcmFtZXRlcnMgb2YgYXJlYVxuICAgICAqL1xuICAgIHB1YmxpYyBlZGl0KGVkaXRpbmdUeXBlOiBzdHJpbmcsIGR4OiBudW1iZXIsIGR5OiBudW1iZXIpIHtcbiAgICAgICAgdmFyIHRlbXBQYXJhbXMgPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzLl9wYXJhbXMpO1xuXG4gICAgICAgIHN3aXRjaCAoZWRpdGluZ1R5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgJ21vdmUnOlxuICAgICAgICAgICAgICAgIHRlbXBQYXJhbXMueCArPSBkeDtcbiAgICAgICAgICAgICAgICB0ZW1wUGFyYW1zLnkgKz0gZHk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgJ2VkaXRMZWZ0JzpcbiAgICAgICAgICAgICAgICB0ZW1wUGFyYW1zLnggKz0gZHg7XG4gICAgICAgICAgICAgICAgdGVtcFBhcmFtcy53aWR0aCAtPSBkeDtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSAnZWRpdFJpZ2h0JzpcbiAgICAgICAgICAgICAgICB0ZW1wUGFyYW1zLndpZHRoICs9IGR4O1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlICdlZGl0VG9wJzpcbiAgICAgICAgICAgICAgICB0ZW1wUGFyYW1zLnkgKz0gZHk7XG4gICAgICAgICAgICAgICAgdGVtcFBhcmFtcy5oZWlnaHQgLT0gZHk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgJ2VkaXRCb3R0b20nOlxuICAgICAgICAgICAgICAgIHRlbXBQYXJhbXMuaGVpZ2h0ICs9IGR5O1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlICdlZGl0VG9wTGVmdCc6XG4gICAgICAgICAgICAgICAgdGVtcFBhcmFtcy54ICs9IGR4O1xuICAgICAgICAgICAgICAgIHRlbXBQYXJhbXMueSArPSBkeTtcbiAgICAgICAgICAgICAgICB0ZW1wUGFyYW1zLndpZHRoIC09IGR4O1xuICAgICAgICAgICAgICAgIHRlbXBQYXJhbXMuaGVpZ2h0IC09IGR5O1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlICdlZGl0VG9wUmlnaHQnOlxuICAgICAgICAgICAgICAgIHRlbXBQYXJhbXMueSArPSBkeTtcbiAgICAgICAgICAgICAgICB0ZW1wUGFyYW1zLndpZHRoICs9IGR4O1xuICAgICAgICAgICAgICAgIHRlbXBQYXJhbXMuaGVpZ2h0IC09IGR5O1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlICdlZGl0Qm90dG9tTGVmdCc6XG4gICAgICAgICAgICAgICAgdGVtcFBhcmFtcy54ICs9IGR4O1xuICAgICAgICAgICAgICAgIHRlbXBQYXJhbXMud2lkdGggLT0gZHg7XG4gICAgICAgICAgICAgICAgdGVtcFBhcmFtcy5oZWlnaHQgKz0gZHk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgJ2VkaXRCb3R0b21SaWdodCc6XG4gICAgICAgICAgICAgICAgdGVtcFBhcmFtcy53aWR0aCArPSBkeDtcbiAgICAgICAgICAgICAgICB0ZW1wUGFyYW1zLmhlaWdodCArPSBkeTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0ZW1wUGFyYW1zO1xuICAgIH1cblxuICAgIHB1YmxpYyBkeW5hbWljRWRpdCh0ZW1wX3BhcmFtczogYW55LCBzYXZlUHJvcG9ydGlvbnM6IGFueSkge1xuICAgICAgICBpZiAodGVtcF9wYXJhbXMud2lkdGggPCAwKSB7XG4gICAgICAgICAgICB0ZW1wX3BhcmFtcy53aWR0aCA9IE1hdGguYWJzKHRlbXBfcGFyYW1zLndpZHRoKTtcbiAgICAgICAgICAgIHRlbXBfcGFyYW1zLnggLT0gdGVtcF9wYXJhbXMud2lkdGg7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGVtcF9wYXJhbXMuaGVpZ2h0IDwgMCkge1xuICAgICAgICAgICAgdGVtcF9wYXJhbXMuaGVpZ2h0ID0gTWF0aC5hYnModGVtcF9wYXJhbXMuaGVpZ2h0KTtcbiAgICAgICAgICAgIHRlbXBfcGFyYW1zLnkgLT0gdGVtcF9wYXJhbXMuaGVpZ2h0O1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHNhdmVQcm9wb3J0aW9ucykge1xuICAgICAgICAgICAgdmFyIHByb3BvcnRpb25zID0gdGhpcy5fcGFyYW1zLndpZHRoIC8gdGhpcy5fcGFyYW1zLmhlaWdodCxcbiAgICAgICAgICAgICAgICBuZXdfcHJvcG9ydGlvbnMgPSB0ZW1wX3BhcmFtcy53aWR0aCAvIHRlbXBfcGFyYW1zLmhlaWdodCxcbiAgICAgICAgICAgICAgICBkZWx0YSA9IG5ld19wcm9wb3J0aW9ucyAtIHByb3BvcnRpb25zLFxuICAgICAgICAgICAgICAgIHgwID0gdGhpcy5fcGFyYW1zLngsXG4gICAgICAgICAgICAgICAgeTAgPSB0aGlzLl9wYXJhbXMueSxcbiAgICAgICAgICAgICAgICB4MSA9IHRlbXBfcGFyYW1zLngsXG4gICAgICAgICAgICAgICAgeTEgPSB0ZW1wX3BhcmFtcy55O1xuXG4gICAgICAgICAgICBpZiAoZGVsdGEgPiAwKSB7XG4gICAgICAgICAgICAgICAgdGVtcF9wYXJhbXMud2lkdGggPSBNYXRoLnJvdW5kKHRlbXBfcGFyYW1zLmhlaWdodCAqIHByb3BvcnRpb25zKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGVtcF9wYXJhbXMuaGVpZ2h0ID0gTWF0aC5yb3VuZCh0ZW1wX3BhcmFtcy53aWR0aCAvIHByb3BvcnRpb25zKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5zZXRTVkdBdHRyaWJ1dGVzKHRlbXBfcGFyYW1zKTtcblxuICAgICAgICByZXR1cm4gdGVtcF9wYXJhbXM7XG4gICAgfVxuXG4gICAgcHVibGljIG9uUHJvY2Vzc0VkaXRpbmcoZTogYW55KSB7XG4gICAgICAgIHJldHVybiB0aGlzLmR5bmFtaWNFZGl0KFxuICAgICAgICAgICAgdGhpcy5lZGl0KFxuICAgICAgICAgICAgICAgIEFyZWEuYXBwLmdldEVkaXRUeXBlKCksXG4gICAgICAgICAgICAgICAgZS5wYWdlWCAtIHRoaXMuZGVsdGEueCxcbiAgICAgICAgICAgICAgICBlLnBhZ2VZIC0gdGhpcy5kZWx0YS55XG4gICAgICAgICAgICApLFxuICAgICAgICAgICAgZS5zaGlmdEtleVxuICAgICAgICApO1xuICAgIH1cblxuICAgIHB1YmxpYyBvblN0b3BFZGl0aW5nKGU6IGFueSkge1xuXG4gICAgICAgIHRoaXMuc2V0UGFyYW1zKHRoaXMub25Qcm9jZXNzRWRpdGluZyhlKSk7XG4gICAgICAgIEFyZWEuYXBwLnJlbW92ZUFsbEV2ZW50cygpXG4gICAgICAgICAgICAuc2V0SXNEcmF3KGZhbHNlKVxuICAgICAgICAgICAgLnJlc2V0TmV3QXJlYSgpO1xuICAgIH1cblxuICAgIHB1YmxpYyB0b1N0cmluZygpIHsgLy90byBodG1sIG1hcCBhcmVhIGNvZGVcbiAgICAgICAgdmFyIHgyID0gdGhpcy5fcGFyYW1zLnggKyB0aGlzLl9wYXJhbXMud2lkdGgsXG4gICAgICAgICAgICB5MiA9IHRoaXMuX3BhcmFtcy55ICsgdGhpcy5fcGFyYW1zLmhlaWdodDtcblxuICAgICAgICByZXR1cm4gJzxhcmVhIHNoYXBlPVwicmVjdFwiIGNvb3Jkcz1cIicgLy8gVE9ETzogdXNlIHRlbXBsYXRlIGVuZ2luZVxuICAgICAgICAgICAgKyB0aGlzLl9wYXJhbXMueCArICcsICdcbiAgICAgICAgICAgICsgdGhpcy5fcGFyYW1zLnkgKyAnLCAnXG4gICAgICAgICAgICArIHgyICsgJywgJ1xuICAgICAgICAgICAgKyB5MlxuICAgICAgICAgICAgKyAnXCInXG4gICAgICAgICAgICArICh0aGlzLmhyZWYgPyAnIGhyZWY9XCInICsgdGhpcy5ocmVmICsgJ1wiJyA6ICcnKVxuICAgICAgICAgICAgKyAodGhpcy5hbHQgPyAnIGFsdD1cIicgKyB0aGlzLmFsdCArICdcIicgOiAnJylcbiAgICAgICAgICAgICsgKHRoaXMudGl0bGUgPyAnIHRpdGxlPVwiJyArIHRoaXMudGl0bGUgKyAnXCInIDogJycpXG4gICAgICAgICAgICArICcgLz4nO1xuICAgIH1cblxuICAgIHB1YmxpYyB0b0pTT04oKTogYW55IHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHR5cGU6ICdyZWN0YW5nbGUnLFxuICAgICAgICAgICAgY29vcmRzOiBbXG4gICAgICAgICAgICAgICAgdGhpcy5fcGFyYW1zLngsXG4gICAgICAgICAgICAgICAgdGhpcy5fcGFyYW1zLnksXG4gICAgICAgICAgICAgICAgdGhpcy5fcGFyYW1zLnggKyB0aGlzLl9wYXJhbXMud2lkdGgsXG4gICAgICAgICAgICAgICAgdGhpcy5fcGFyYW1zLnkgKyB0aGlzLl9wYXJhbXMuaGVpZ2h0XG4gICAgICAgICAgICBdLFxuICAgICAgICAgICAgaHJlZjogdGhpcy5hdHRyaWJ1dGVzLmhyZWYsXG4gICAgICAgICAgICBhbHQ6IHRoaXMuYXR0cmlidXRlcy5hbHQsXG4gICAgICAgICAgICB0aXRsZTogdGhpcy5hdHRyaWJ1dGVzLnRpdGxlXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0cnVlIGlmIGNvb3JkcyBhcnJheSBpcyB2YWxpZCBmb3IgcmVjdGFuZ2xlcyBhbmQgZmFsc2Ugb3RoZXJ3aXNlXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQHBhcmFtIGNvb3JkcyB7QXJyYXl9IC0gY29vcmRzIGZvciBuZXcgcmVjdGFuZ2xlIGFzIGFycmF5XG4gICAgICogQHJldHVybiB7Ym9vbGVhbn1cbiAgICAgKi9cbiAgICBwdWJsaWMgc3RhdGljIHRlc3RDb29yZHMoY29vcmRzKSB7XG4gICAgICAgIHJldHVybiBjb29yZHMubGVuZ3RoID09PSA0O1xuICAgIH1cblxuICAgIHB1YmxpYyBzdGF0aWMgY3JlYXRlRnJvbVNhdmVkKHBhcmFtczogYW55KSB7XG4gICAgICAgIGlmICghdGhpcy50ZXN0Q29vcmRzKHBhcmFtcy5jb29yZHMpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBBcmVhLmFwcC5zZXRJc0RyYXcodHJ1ZSk7XG5cbiAgICAgICAgdmFyIGFyZWEgPSBuZXcgUmVjdGFuZ2xlKHtcbiAgICAgICAgICAgIHg6IHBhcmFtcy5jb29yZHNbMF0sXG4gICAgICAgICAgICB5OiBwYXJhbXMuY29vcmRzWzFdLFxuICAgICAgICAgICAgbjogcGFyYW1zLm51bWJlclxuICAgICAgICB9KTtcblxuICAgICAgICBhcmVhLnNldFBhcmFtcyhhcmVhLmR5bmFtaWNEcmF3KHBhcmFtcy5jb29yZHNbMl0sIHBhcmFtcy5jb29yZHNbM10pKS5kZXNlbGVjdCgpO1xuXG4gICAgICAgIEFyZWEuYXBwLnNldElzRHJhdyhmYWxzZSlcbiAgICAgICAgICAgIC5yZXNldE5ld0FyZWEoKTtcblxuICAgICAgICBhcmVhLnNldEluZm9BdHRyaWJ1dGVzKHBhcmFtcyk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgbmV3IHJlY3RhbmdsZSBhbmQgYWRkIGRyYXdpbmcgaGFuZGxlcnMgZm9yIERPTS1lbGVtZW50c1xuICAgICAqXG4gICAgICogQHBhcmFtIGNvb3JkcyB7T2JqZWN0fSBjb29yZHNcbiAgICAgKiBAcmV0dXJucyBjcmVhdGVkIHJlY3RhbmdsZVxuICAgICAqL1xuICAgIHB1YmxpYyBzdGF0aWMgIGNyZWF0ZUFuZFN0YXJ0RHJhd2luZyhjb29yZHMpIHtcbiAgICAgICAgY29vcmRzLm4gPSBBcmVhLmFwcC5nZXRBcmVhcygpLmxlbmd0aDtcbiAgICAgICAgdmFyIG5ld0FyZWEgPSBuZXcgUmVjdGFuZ2xlKGNvb3Jkcyk7XG5cbiAgICAgICAgQXJlYS5hcHAuYWRkRXZlbnQoQXJlYS5hcHAuZG9tRWxlbWVudHMuY29udGFpbmVyLCAnbW91c2Vtb3ZlJywgbmV3QXJlYS5vblByb2Nlc3NEcmF3aW5nLmJpbmQobmV3QXJlYSkpXG4gICAgICAgICAgICAuYWRkRXZlbnQoQXJlYS5hcHAuZG9tRWxlbWVudHMuY29udGFpbmVyLCAnY2xpY2snLCBuZXdBcmVhLm9uU3RvcERyYXdpbmcuYmluZChuZXdBcmVhKSk7XG5cbiAgICAgICAgcmV0dXJuIG5ld0FyZWE7XG4gICAgfVxufSJdfQ==